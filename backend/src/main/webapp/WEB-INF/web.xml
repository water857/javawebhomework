<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!-- 定时任务监听器 -->
    <listener>
        <listener-class>com.smartcommunity.listener.SchedulerListener</listener-class>
    </listener>

    <!-- CORS过滤器 -->
    <filter>
        <filter-name>CorsFilter</filter-name>
        <filter-class>com.smartcommunity.filter.CorsFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>CorsFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

    <!-- 字符编码过滤器 -->
    <filter>
        <filter-name>CharacterEncodingFilter</filter-name>
        <filter-class>com.smartcommunity.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
        <init-param>
            <param-name>forceEncoding</param-name>
            <param-value>true</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>CharacterEncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

    <!-- JWT认证过滤器 -->
    <filter>
        <filter-name>JwtAuthFilter</filter-name>
        <filter-class>com.smartcommunity.filter.JwtAuthFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>JwtAuthFilter</filter-name>
        <url-pattern>/api/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </filter-mapping>

    <!-- 角色权限过滤器 -->
    <filter>
        <filter-name>RoleFilter</filter-name>
        <filter-class>com.smartcommunity.filter.RoleFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>RoleFilter</filter-name>
        <url-pattern>/api/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
    </filter-mapping>

    <!-- 注册Servlet -->
    <servlet>
        <servlet-name>RegisterServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.RegisterServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>RegisterServlet</servlet-name>
        <url-pattern>/api/register</url-pattern>
    </servlet-mapping>

    <!-- 登录Servlet -->
    <servlet>
        <servlet-name>LoginServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.LoginServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LoginServlet</servlet-name>
        <url-pattern>/api/login</url-pattern>
    </servlet-mapping>

    <!-- 用户信息Servlet -->
    <servlet>
        <servlet-name>UserServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.UserServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/user</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/user/*</url-pattern>
    </servlet-mapping>
    <!-- 个人资料更新Servlet映射 -->
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/profile/update</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/profile/update-idcard</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/change-password</url-pattern>
    </servlet-mapping>

    <!-- 居民管理API映射 -->
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/residents</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/residents/*</url-pattern>
    </servlet-mapping>
    <!-- 服务商管理API映射 -->
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/providers</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/api/providers/*</url-pattern>
    </servlet-mapping>

    <!-- API信息Servlet -->
    <servlet>
        <servlet-name>ApiInfoServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.ApiInfoServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>ApiInfoServlet</servlet-name>
        <url-pattern>/api</url-pattern>
    </servlet-mapping>
    
    <!-- 维修管理Servlet -->
    <servlet>
        <servlet-name>RepairServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.RepairServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>RepairServlet</servlet-name>
        <url-pattern>/api/repair</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>RepairServlet</servlet-name>
        <url-pattern>/api/repair/*</url-pattern>
    </servlet-mapping>

    <!-- 邻里圈Servlet -->
    <servlet>
        <servlet-name>CommunityPostServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.CommunityPostServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>CommunityPostServlet</servlet-name>
        <url-pattern>/api/community</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>CommunityPostServlet</servlet-name>
        <url-pattern>/api/community/*</url-pattern>
    </servlet-mapping>

    <!-- 活动管理Servlet -->
    <servlet>
        <servlet-name>ActivityServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.ActivityServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>ActivityServlet</servlet-name>
        <url-pattern>/api/activities</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>ActivityServlet</servlet-name>
        <url-pattern>/api/activities/*</url-pattern>
    </servlet-mapping>

    <!-- 静态资源Servlet -->
    <servlet>
        <servlet-name>StaticResourceServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.StaticResourceServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>StaticResourceServlet</servlet-name>
        <url-pattern>/uploads/*</url-pattern>
    </servlet-mapping>

    <!-- 私信Servlet -->
    <servlet>
        <servlet-name>MessageServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.MessageServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>MessageServlet</servlet-name>
        <url-pattern>/api/message/*</url-pattern>
    </servlet-mapping>

    <!-- 车位管理Servlet -->
    <servlet>
        <servlet-name>ParkingServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.ParkingServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>ParkingServlet</servlet-name>
        <url-pattern>/api/parking/*</url-pattern>
    </servlet-mapping>

    <!-- 访客登记Servlet -->
    <servlet>
        <servlet-name>VisitorServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.VisitorServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>VisitorServlet</servlet-name>
        <url-pattern>/api/visitor/*</url-pattern>
    </servlet-mapping>

    <!-- 二手市场Servlet -->
    <servlet>
        <servlet-name>SecondHandServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.SecondHandServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>SecondHandServlet</servlet-name>
        <url-pattern>/api/second-hand/*</url-pattern>
    </servlet-mapping>

    <!-- 技能交换Servlet -->
    <servlet>
        <servlet-name>SkillShareServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.SkillShareServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>SkillShareServlet</servlet-name>
        <url-pattern>/api/skills/*</url-pattern>
    </servlet-mapping>

    <!-- 失物招领Servlet -->
    <servlet>
        <servlet-name>LostAndFoundServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.LostAndFoundServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LostAndFoundServlet</servlet-name>
        <url-pattern>/api/lost-found/*</url-pattern>
    </servlet-mapping>

    <!-- 物业费管理Servlet -->
    <servlet>
        <servlet-name>PropertyFeeServlet</servlet-name>
        <servlet-class>com.smartcommunity.servlet.PropertyFeeServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>PropertyFeeServlet</servlet-name>
        <url-pattern>/api/property-fee/*</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>PropertyFeeServlet</servlet-name>
        <url-pattern>/api/admin/property-fee/*</url-pattern>
    </servlet-mapping>

</web-app>