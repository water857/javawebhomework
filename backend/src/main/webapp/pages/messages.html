<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>私信列表</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">私信列表</h1>
    <div class="alert alert-info">请先登录前端系统并在 localStorage 中保存 token。</div>
    <button class="btn btn-primary mb-3" onclick="loadConversations()">刷新列表</button>
    <div class="list-group" id="conversationList"></div>
</div>

<script>
const apiBase = '/backend/api/message/list';

function getToken() {
  return localStorage.getItem('token');
}

async function loadConversations() {
  const token = getToken();
  const resp = await fetch(apiBase, {
    headers: {
      'Authorization': token ? `Bearer ${token}` : ''
    }
  });
  const data = await resp.json();
  const list = document.getElementById('conversationList');
  list.innerHTML = '';
  if (!data || !data.data) {
    list.innerHTML = '<div class="text-muted">暂无会话</div>';
    return;
  }
  data.data.forEach(item => {
    const row = document.createElement('a');
    row.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
    row.href = `message-chat.html?withUserId=${item.otherUserId}`;
    row.innerHTML = `
      <div>
        <div class="fw-bold">${item.otherRealName || item.otherUsername}</div>
        <small class="text-muted">${item.lastMessage || ''}</small>
      </div>
      <span class="badge bg-danger">${item.unreadCount}</span>
    `;
    list.appendChild(row);
  });
}

loadConversations();
</script>
</body>
</html>
