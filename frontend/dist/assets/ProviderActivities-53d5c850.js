import{c as o}from"./api-5fa05d82.js";import{_ as g,o as c,c as r,a as i,e as d,v as p,h as f,l as m,m as P,F as _,i as y,t as n,f as h,n as b,d as v}from"./index-1ef266be.js";const A={name:"ProviderActivities",data(){return{activities:[],loading:!1,searchQuery:"",statusFilter:"",currentPage:1,pageSize:10,totalPages:1,isMyActivities:!1}},computed:{currentUserId(){return typeof localStorage<"u"?localStorage.getItem("userId"):""}},mounted(){this.fetchActivities()},methods:{async fetchActivities(){this.loading=!0;try{let s;if(this.isMyActivities){const t=this.currentUserId;if(!t){alert("无法获取用户信息，请重新登录"),this.loading=!1;return}s=await o.getUserActivities(t,this.currentPage,this.pageSize,this.searchQuery,this.statusFilter)}else s=await o.getActivities(this.currentPage,this.pageSize,this.searchQuery,this.statusFilter);s.code==="success"?(this.activities=s.data,this.totalPages=s.totalPages||1):console.error("获取活动列表失败:",s.message)}catch(s){console.error("获取活动列表失败:",s),alert("获取活动列表失败，请稍后重试")}finally{this.loading=!1}},formatDateTime(s){return new Date(s).toLocaleString("zh-CN")},getStatusText(s){return{pending:"待开始",ongoing:"进行中",completed:"已完成",cancelled:"已取消"}[s]||s},handleActivityDetail(s){this.$router.push(`/provider/activities/${s}`)},handlePublishActivity(){this.$router.push("/provider/activities/publish")},handleEditActivity(s){this.$router.push(`/provider/activities/edit/${s}`)},handleDeleteActivity(s){confirm("确定要删除这个活动吗？")&&o.deleteActivity(s).then(t=>{t.code==="success"?(alert("活动删除成功"),this.fetchActivities()):alert(`删除失败: ${t.message}`)}).catch(t=>{console.error("删除活动失败:",t),alert("删除活动失败，请稍后重试")})},handleBack(){this.$router.push("/provider")},handlePrevPage(){this.currentPage>1&&(this.currentPage--,this.fetchActivities())},handleNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchActivities())}}},k={class:"container"},x={class:"header-actions"},C={class:"activities-section"},S={class:"filter-section"},D={class:"checkbox-filter"},M={class:"activities-list"},I={key:0,class:"loading"},N={key:1,class:"no-data"},T=["onClick"],F={class:"activity-date"},U={class:"activity-location"},B={class:"activity-info"},V={key:0,class:"activity-actions"},w=["onClick"],z=["onClick"],Q={key:0,class:"pagination"},E=["disabled"],L=["disabled"];function j(s,t,q,G,l,a){return c(),r("div",k,[i("header",null,[t[8]||(t[8]=i("h1",null,"社区活动",-1)),i("div",x,[i("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>a.handlePublishActivity&&a.handlePublishActivity(...e))},"发布活动"),i("button",{class:"btn",onClick:t[1]||(t[1]=(...e)=>a.handleBack&&a.handleBack(...e))},"返回首页")])]),i("div",C,[i("div",S,[d(i("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>l.searchQuery=e),placeholder:"搜索活动",class:"search-input"},null,512),[[p,l.searchQuery]]),d(i("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.statusFilter=e),class:"filter-select"},[...t[9]||(t[9]=[m('<option value="" data-v-5ec45c1c>全部状态</option><option value="pending" data-v-5ec45c1c>待开始</option><option value="ongoing" data-v-5ec45c1c>进行中</option><option value="completed" data-v-5ec45c1c>已完成</option><option value="cancelled" data-v-5ec45c1c>已取消</option>',5)])],512),[[f,l.statusFilter]]),i("div",D,[d(i("input",{type:"checkbox",id:"myActivities","onUpdate:modelValue":t[4]||(t[4]=e=>l.isMyActivities=e)},null,512),[[P,l.isMyActivities]]),t[10]||(t[10]=i("label",{for:"myActivities"},"只看我发布的活动",-1))]),i("button",{class:"btn",onClick:t[5]||(t[5]=(...e)=>a.fetchActivities&&a.fetchActivities(...e))},"筛选")]),i("div",M,[l.loading?(c(),r("div",I,"加载中...")):l.activities.length===0?(c(),r("div",N,"暂无活动")):(c(!0),r(_,{key:2},y(l.activities,e=>(c(),r("div",{class:"activity-card",key:e.id},[i("div",{class:"activity-content",onClick:u=>a.handleActivityDetail(e.id)},[i("h3",null,n(e.title),1),i("p",F,n(a.formatDateTime(e.startTime))+" - "+n(a.formatDateTime(e.endTime)),1),i("p",U,n(e.location),1),i("p",{class:b(["activity-status",e.status])},n(a.getStatusText(e.status)),3),i("div",B,[i("span",null,"发布者: "+n(e.publisherName||"匿名"),1),i("span",null,"参与人数: "+n(e.currentParticipants)+"/"+n(e.maxParticipants||"无限制"),1)])],8,T),e.userId==a.currentUserId?(c(),r("div",V,[i("button",{class:"btn btn-edit",onClick:v(u=>a.handleEditActivity(e.id),["stop"])},"编辑",8,w),i("button",{class:"btn btn-delete",onClick:v(u=>a.handleDeleteActivity(e.id),["stop"])},"删除",8,z)])):h("",!0)]))),128))]),l.totalPages>1?(c(),r("div",Q,[i("button",{class:"btn",onClick:t[6]||(t[6]=(...e)=>a.handlePrevPage&&a.handlePrevPage(...e)),disabled:l.currentPage===1},"上一页",8,E),i("span",null,n(l.currentPage)+"/"+n(l.totalPages),1),i("button",{class:"btn",onClick:t[7]||(t[7]=(...e)=>a.handleNextPage&&a.handleNextPage(...e)),disabled:l.currentPage===l.totalPages},"下一页",8,L)])):h("",!0)])])}const K=g(A,[["render",j],["__scopeId","data-v-5ec45c1c"]]);export{K as default};
//# sourceMappingURL=ProviderActivities-53d5c850.js.map
