import{w as m}from"./api-5fa05d82.js";import{_ as p,o as a,c as u,a as t,t as d,f as h}from"./index-1ef266be.js";class b{constructor(){this.socket=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.listeners=new Map,this.userId=null}connect(e){if(this.socket&&this.isConnected){console.log("WebSocketå·²ç»è¿žæŽ¥");return}this.userId=e;const o=`ws://localhost:8080/backend/websocket/${e}`;try{this.socket=new WebSocket(o),this.socket.onopen=()=>{console.log("WebSocketè¿žæŽ¥æˆåŠŸ"),this.isConnected=!0,this.reconnectAttempts=0},this.socket.onmessage=r=>{console.log("æ”¶åˆ°WebSocketæ¶ˆæ¯:",r.data),this.handleMessage(r.data)},this.socket.onclose=()=>{console.log("WebSocketè¿žæŽ¥å…³é—­"),this.isConnected=!1,this.attemptReconnect()},this.socket.onerror=r=>{console.error("WebSocketé”™è¯¯:",r),this.isConnected=!1}}catch(r){console.error("WebSocketè¿žæŽ¥å¤±è´¥:",r),this.isConnected=!1,this.attemptReconnect()}}attemptReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`å°è¯•é‡æ–°è¿žæŽ¥... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(this.userId)},this.reconnectDelay)):console.error("WebSocketé‡è¿žå¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")}sendMessage(e){if(this.socket&&this.isConnected)try{this.socket.send(JSON.stringify(e)),console.log("å‘é€WebSocketæ¶ˆæ¯:",e)}catch(o){console.error("å‘é€WebSocketæ¶ˆæ¯å¤±è´¥:",o)}else console.error("WebSocketæœªè¿žæŽ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯")}handleMessage(e){try{const o=JSON.parse(e),r=o.type;this.listeners.has(r)&&this.listeners.get(r).forEach(s=>{try{s(o)}catch(n){console.error("å¤„ç†WebSocketæ¶ˆæ¯ç›‘å¬å™¨å¤±è´¥:",n)}}),this.listeners.has("*")&&this.listeners.get("*").forEach(s=>{try{s(o)}catch(n){console.error("å¤„ç†WebSocketå…¨å±€ç›‘å¬å™¨å¤±è´¥:",n)}})}catch(o){console.error("è§£æžWebSocketæ¶ˆæ¯å¤±è´¥:",o)}}subscribe(e,o){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(o),()=>{this.unsubscribe(e,o)}}unsubscribe(e,o){if(this.listeners.has(e)){const r=this.listeners.get(e),i=r.indexOf(o);i>-1&&r.splice(i,1)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null,this.isConnected=!1,this.listeners.clear(),console.log("WebSocketè¿žæŽ¥å·²æ–­å¼€"))}getConnectionStatus(){return this.isConnected}}const c=new b;const f={name:"Resident",data(){return{username:"",weatherTips:"",notification:"",userId:""}},mounted(){this.username=localStorage.getItem("username"),this.userId=localStorage.getItem("username"),this.initWebSocket(),this.getWeatherInfo()},beforeUnmount(){c.disconnect()},methods:{initWebSocket(){this.userId&&(c.connect(this.userId),c.subscribe("weather_tips",l=>{this.weatherTips=l.content,this.notification="æ”¶åˆ°æ–°çš„å¤©æ°”æ¸©é¦¨æç¤ºï¼"}),c.subscribe("*",l=>{console.log("æ”¶åˆ°å…¨å±€æ¶ˆæ¯:",l)}))},async getWeatherInfo(){try{const l=await m.getWeatherTips();l.success&&(this.weatherTips=l.data)}catch(l){console.error("èŽ·å–å¤©æ°”ä¿¡æ¯å¤±è´¥:",l)}},handleProfile(){this.$router.push("/resident/profile")},handleRepair(){this.$router.push("/resident/repairs")},handleLogout(){c.disconnect(),localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("realName"),localStorage.removeItem("phone"),localStorage.removeItem("email"),localStorage.removeItem("address"),localStorage.removeItem("idCard"),this.$router.push("/login")},handleCommunity(){this.$router.push("/resident/community")},handleActivities(){this.$router.push("/resident/activities")},handleAnnouncements(){this.$router.push("/resident/announcements")},handlePropertyFee(){this.$router.push("/resident/property-fee")}}},k={class:"container"},g={class:"user-info"},S={key:0,class:"weather-tips"},v={key:1,class:"notification"},y={class:"role-features"},C={class:"features-grid"},W={class:"feature-card"},I={class:"feature-card"},w={class:"feature-card"},A={class:"feature-card"},R={class:"feature-card"};function x(l,e,o,r,i,s){return a(),u("div",k,[t("header",null,[e[8]||(e[8]=t("h1",null,"å±…æ°‘ä¸­å¿ƒ",-1)),t("div",g,[t("span",null,"æ¬¢è¿Žæ‚¨ï¼Œ"+d(i.username),1),t("button",{class:"btn",onClick:e[0]||(e[0]=(...n)=>s.handleProfile&&s.handleProfile(...n))},"ä¸ªäººä¸­å¿ƒ"),t("button",{class:"btn",onClick:e[1]||(e[1]=(...n)=>s.handleLogout&&s.handleLogout(...n))},"é€€å‡ºç™»å½•")])]),i.weatherTips?(a(),u("div",S,[e[9]||(e[9]=t("h3",null,"ðŸŒ¤ï¸ ä»Šæ—¥å¤©æ°”æ¸©é¦¨æç¤º",-1)),t("pre",null,d(i.weatherTips),1)])):h("",!0),i.notification?(a(),u("div",v,[e[10]||(e[10]=t("h3",null,"ðŸ“¢ é€šçŸ¥",-1)),t("p",null,d(i.notification),1),t("button",{class:"close-btn",onClick:e[2]||(e[2]=n=>i.notification="")},"Ã—")])):h("",!0),t("div",y,[e[22]||(e[22]=t("h2",null,"å±…æ°‘åŠŸèƒ½",-1)),t("div",C,[t("div",W,[e[11]||(e[11]=t("h3",null,"ç‰©ä¸šæŠ¥ä¿®",-1)),e[12]||(e[12]=t("p",null,"æäº¤å®¶ä¸­è®¾å¤‡æ•…éšœç»´ä¿®ç”³è¯·",-1)),t("button",{class:"btn",onClick:e[3]||(e[3]=(...n)=>s.handleRepair&&s.handleRepair(...n))},"ç«‹å³æŠ¥ä¿®")]),t("div",I,[e[13]||(e[13]=t("h3",null,"è´¹ç”¨æŸ¥è¯¢",-1)),e[14]||(e[14]=t("p",null,"æŸ¥çœ‹ç‰©ä¸šè´¹ã€æ°´ç”µè´¹ç­‰è´¦å•ä¿¡æ¯",-1)),t("button",{class:"btn",onClick:e[4]||(e[4]=(...n)=>s.handlePropertyFee&&s.handlePropertyFee(...n))},"æŸ¥è¯¢è´¦å•")]),t("div",w,[e[15]||(e[15]=t("h3",null,"ç¤¾åŒºå…¬å‘Š",-1)),e[16]||(e[16]=t("p",null,"æµè§ˆç¤¾åŒºæœ€æ–°é€šçŸ¥å’Œæ´»åŠ¨ä¿¡æ¯",-1)),t("button",{class:"btn",onClick:e[5]||(e[5]=(...n)=>s.handleAnnouncements&&s.handleAnnouncements(...n))},"æŸ¥çœ‹å…¬å‘Š")]),e[21]||(e[21]=t("div",{class:"feature-card"},[t("h3",null,"æœåŠ¡é¢„çº¦"),t("p",null,"é¢„çº¦ç¤¾åŒºæœåŠ¡ï¼ˆæ¸…æ´ã€ç»´ä¿®ç­‰ï¼‰"),t("button",{class:"btn"},"é¢„çº¦æœåŠ¡")],-1)),t("div",A,[e[17]||(e[17]=t("h3",null,"é‚»é‡Œåœˆ",-1)),e[18]||(e[18]=t("p",null,"åˆ†äº«ç”Ÿæ´»åŠ¨æ€ï¼Œä¸Žé‚»å±…äº’åŠ¨äº¤æµ",-1)),t("button",{class:"btn",onClick:e[6]||(e[6]=(...n)=>s.handleCommunity&&s.handleCommunity(...n))},"è¿›å…¥é‚»é‡Œåœˆ")]),t("div",R,[e[19]||(e[19]=t("h3",null,"ç¤¾åŒºæ´»åŠ¨",-1)),e[20]||(e[20]=t("p",null,"æŸ¥çœ‹å’Œå‚ä¸Žç¤¾åŒºç»„ç»‡çš„å„ç§æ´»åŠ¨",-1)),t("button",{class:"btn",onClick:e[7]||(e[7]=(...n)=>s.handleActivities&&s.handleActivities(...n))},"æŸ¥çœ‹æ´»åŠ¨")])])])])}const N=p(f,[["render",x],["__scopeId","data-v-e6c21e15"]]);export{N as default};
//# sourceMappingURL=Resident-79ec0819.js.map
