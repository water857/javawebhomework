import{_ as me,u as ve,p,q as J,o as r,c as u,a as e,g as S,e as c,h as M,l as fe,v as y,F as D,i as w,f as I,t as n,n as O,m as ce}from"./index-1ef266be.js";import{a as pe,p as F}from"./api-5fa05d82.js";const be={name:"AdminPropertyFeeManagement",setup(){const U=ve(),t=p([]),k=p([]),l=p({status:"",startDate:"",endDate:""}),V=p(!1),x=p(!1),E=p(null),i=p({periodStart:"",periodEnd:"",dueDate:"",feeItems:[{name:"ç‰©ä¸šè´¹",amount:100},{name:"æ°´è´¹",amount:50},{name:"ç”µè´¹",amount:80},{name:"åƒåœ¾å¤„ç†è´¹",amount:15}],billType:"all",selectedUsers:[],importedData:null}),C=p([]),T=p(!1),_=p(!1),g=p(null),B=p(!1),v=p({}),s=async()=>{try{const o=await pe("/residents");k.value=o.data||[]}catch(o){console.error("è·å–å±…æ°‘ä¿¡æ¯å¤±è´¥:",o),alert("è·å–å±…æ°‘ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},m=async()=>{try{const o=await F.getAllBills({status:l.value.status,startDate:l.value.startDate,endDate:l.value.endDate});t.value=o.data||[];for(const a of t.value)await f(a)}catch(o){console.error("è·å–è´¦å•åˆ—è¡¨å¤±è´¥:",o),alert("è·å–è´¦å•åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},f=async o=>{try{const a=await F.getPaymentHistory(1,10,{billId:o.id});o.payments=a.data||[]}catch(a){console.error(`è·å–è´¦å• ${o.id} çš„æ”¯ä»˜è®°å½•å¤±è´¥:`,a),o.payments=[]}},A=()=>{m()},z=()=>{l.value={status:"",startDate:"",endDate:""},m()},L=()=>{alert("å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...")},H=async o=>{if(o.target.files[0])try{alert("æ–‡ä»¶å¯¼å…¥æˆåŠŸï¼ï¼ˆæ¨¡æ‹Ÿå®ç°ï¼‰");const d={feeItems:[{name:"ç‰©ä¸šè´¹",amount:120},{name:"æ°´è´¹",amount:60},{name:"ç”µè´¹",amount:90},{name:"åƒåœ¾å¤„ç†è´¹",amount:20}]};i.value.feeItems=d.feeItems,i.value.importedData=d,await N()}catch(d){console.error("æ–‡ä»¶å¯¼å…¥å¤±è´¥:",d),alert("æ–‡ä»¶å¯¼å…¥å¤±è´¥ï¼š"+d.message)}};J(()=>{s(),m()});const N=async()=>{try{const o=i.value.billType==="all"?k.value.map(d=>d):k.value.filter(d=>i.value.selectedUsers.includes(d.id)),a=parseFloat(P());C.value=o.map(d=>({userId:d.id,userName:d.realName,userAddress:d.address,periodStart:i.value.periodStart,periodEnd:i.value.periodEnd,dueDate:i.value.dueDate,totalAmount:a,feeItems:i.value.feeItems})),T.value=!0}catch(o){console.error("ç”Ÿæˆé¢„è§ˆæ•°æ®å¤±è´¥:",o),alert("ç”Ÿæˆé¢„è§ˆæ•°æ®å¤±è´¥ï¼š"+o.message)}},j=async()=>{await N()},K=()=>{i.value.feeItems.push({name:"",amount:0})},Q=o=>{i.value.feeItems.length>1&&i.value.feeItems.splice(o,1)},W=()=>i.value.billType==="all"?k.value.length:i.value.selectedUsers.length,X=()=>i.value.feeItems.length,P=()=>i.value.feeItems.reduce((o,a)=>o+(a.amount||0),0).toFixed(2),Y=async()=>{var o,a;x.value=!0;try{const d=[],b=i.value.billType==="all"?k.value.map(q=>q.id):i.value.selectedUsers,h=parseFloat(P());for(const q of b)d.push({userId:q,periodStart:i.value.periodStart,periodEnd:i.value.periodEnd,amount:h,items:JSON.stringify(i.value.feeItems),dueDate:i.value.dueDate,status:"unpaid",paymentDeadlineReminderSent:!1});const R=await F.batchGenerateBills({bills:d});alert(`æˆåŠŸç”Ÿæˆ ${R.data.count} ä»½è´¦å•ï¼`),V.value=!1,m()}catch(d){console.error("æ‰¹é‡ç”Ÿæˆè´¦å•å¤±è´¥:",d),alert("æ‰¹é‡ç”Ÿæˆè´¦å•å¤±è´¥ï¼š"+(((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.message)||d.message))}finally{x.value=!1}},Z=async o=>{try{const a=await F.getBillDetail(o.id);g.value=a.data.bill||o,g.value.resident=a.data.resident||null,_.value=!0}catch(a){console.error("è·å–è´¦å•è¯¦æƒ…å¤±è´¥:",a),g.value=o,g.value.resident=null,_.value=!0}},$=o=>{v.value={id:o.id,userId:o.userId,amount:o.amount,status:o.status,periodStart:new Date(o.periodStart).toISOString().split("T")[0],periodEnd:new Date(o.periodEnd).toISOString().split("T")[0],dueDate:new Date(o.dueDate).toISOString().split("T")[0],paymentDeadlineReminderSent:o.paymentDeadlineReminderSent||!1,feeItems:o.items?JSON.parse(o.items):[{name:"ç‰©ä¸šè´¹",amount:o.amount}]},B.value=!0},ee=()=>{v.value.feeItems.push({name:"",amount:0})},te=o=>{v.value.feeItems.length>1&&v.value.feeItems.splice(o,1)},G=()=>v.value.feeItems?v.value.feeItems.reduce((o,a)=>o+(a.amount||0),0).toFixed(2):0,le=async()=>{var o,a;try{v.value.amount=parseFloat(G());const d={...v.value,items:JSON.stringify(v.value.feeItems),periodStart:v.value.periodStart,periodEnd:v.value.periodEnd},b=await F.updateBill(v.value.id,d),h=t.value.findIndex(R=>R.id===v.value.id);h!==-1&&(t.value[h]={...t.value[h],...v.value,amount:parseFloat(G()),items:JSON.stringify(v.value.feeItems)}),alert("è´¦å•ä¿®æ”¹æˆåŠŸï¼"),B.value=!1}catch(d){console.error("ä¿®æ”¹è´¦å•å¤±è´¥:",d),alert("ä¿®æ”¹è´¦å•å¤±è´¥ï¼š"+(((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.message)||d.message))}},se=async o=>{var a,d;if(confirm("ç¡®å®šè¦åˆ é™¤è¯¥è´¦å•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼"))try{await F.deleteBill(o),alert("è´¦å•åˆ é™¤æˆåŠŸï¼"),m()}catch(b){console.error("åˆ é™¤è´¦å•å¤±è´¥:",b),alert("åˆ é™¤è´¦å•å¤±è´¥ï¼š"+(((d=(a=b.response)==null?void 0:a.data)==null?void 0:d.message)||b.message))}},oe=async o=>{var a,d;try{await F.sendReminder(o.id),o.paymentDeadlineReminderSent=!0,alert("å‚¬ç¼´æé†’å‘é€æˆåŠŸï¼")}catch(b){console.error("å‘é€å‚¬ç¼´æé†’å¤±è´¥:",b),alert("å‘é€å‚¬ç¼´æé†’å¤±è´¥ï¼š"+(((d=(a=b.response)==null?void 0:a.data)==null?void 0:d.message)||b.message))}},ne=o=>o?new Date(o).toLocaleDateString("zh-CN"):"",ae=o=>o?new Date(o).toLocaleString("zh-CN"):"",de=o=>({unpaid:"æœªæ”¯ä»˜",paid:"å·²æ”¯ä»˜",overdue:"å·²é€¾æœŸ",partially_paid:"éƒ¨åˆ†æ”¯ä»˜"})[o]||o,ie=o=>({wechat:"å¾®ä¿¡æ”¯ä»˜",alipay:"æ”¯ä»˜å®",bank_transfer:"é“¶è¡Œè½¬è´¦",auto_deduction:"è‡ªåŠ¨æ‰£è´¹"})[o]||o,re=o=>({pending:"å¾…å¤„ç†",success:"æˆåŠŸ",failed:"å¤±è´¥",refunded:"å·²é€€æ¬¾"})[o]||o,ue=()=>{U.push("/admin")};return J(async()=>{await s(),await m()}),{bills:t,residents:k,filter:l,showGenerateModal:V,isGenerating:x,fileInput:E,generateForm:i,previewData:C,showPreviewTable:T,showDetailModal:_,selectedBill:g,showEditModal:B,editForm:v,getResidents:s,getBills:m,loadPaymentsForBill:f,refreshBills:A,resetFilter:z,exportBills:L,handleFileImport:H,generatePreviewData:N,previewGeneration:j,addFeeItem:K,removeFeeItem:Q,addEditFeeItem:ee,removeEditFeeItem:te,calculateEditTotalAmount:G,getPreviewCount:W,getTotalAmountPerBill:X,calculateTotalAmount:P,generateBills:Y,viewBillDetails:Z,editBill:$,saveEdit:le,deleteBill:se,sendReminder:oe,formatDate:ne,formatDateTime:ae,getStatusText:de,getPaymentMethodText:ie,getPaymentStatusText:re,goBack:ue}}},ye={class:"admin-property-fee-management"},ge={class:"header-section"},De={class:"action-section"},we={class:"filter-section"},Ie={class:"filter-item"},ke={class:"filter-item"},Fe={class:"filter-item"},_e={class:"filter-item"},Be={class:"bills-section"},Se={class:"bills-table"},Ce={class:"action-buttons"},Te=["onClick"],he=["onClick"],xe=["onClick"],Ee=["onClick","disabled"],Me={key:0,class:"empty-state"},Ue={key:0,class:"modal"},Ve={class:"modal-content"},Ae={class:"modal-header"},Ne={class:"modal-body"},Pe={class:"form-group"},Ge={class:"import-section"},Re={class:"form-group"},qe={class:"form-group"},Oe={class:"form-group"},Je={class:"form-group"},ze={class:"fee-items-container"},Le=["onUpdate:modelValue"],He=["onUpdate:modelValue"],je=["onClick","disabled"],Ke={class:"form-group"},Qe={key:0,class:"form-group"},We=["value"],Xe={class:"preview-section"},Ye={class:"preview-item"},Ze={class:"preview-value"},$e={class:"preview-item"},et={class:"preview-value"},tt={class:"preview-item"},lt={class:"preview-value"},st={key:1,class:"detailed-preview-section"},ot={class:"preview-table-container"},nt={class:"preview-table"},at={class:"fee-items-list"},dt={class:"modal-footer"},it=["disabled"],rt={key:1,class:"modal"},ut={class:"modal-content"},mt={class:"modal-header"},vt={class:"header-buttons"},ft={class:"modal-body"},ct={class:"detail-section resident-info-section"},pt={class:"resident-info-grid"},bt={class:"resident-info-item"},yt={class:"detail-value"},gt={class:"resident-info-item"},Dt={class:"detail-value"},wt={class:"resident-info-item"},It={class:"detail-value"},kt={class:"resident-info-item"},Ft={class:"detail-value"},_t={class:"resident-info-item"},Bt={class:"detail-value"},St={class:"resident-info-item"},Ct={class:"detail-value"},Tt={class:"resident-info-item"},ht={class:"detail-value"},xt={class:"resident-info-item"},Et={class:"detail-value"},Mt={class:"detail-row"},Ut={class:"detail-value"},Vt={class:"detail-row"},At={class:"detail-value"},Nt={class:"detail-row"},Pt={class:"detail-value"},Gt={class:"detail-row"},Rt={class:"detail-value amount"},qt={class:"detail-row"},Ot={class:"detail-value"},Jt={class:"detail-row"},zt={class:"detail-value"},Lt={key:0,class:"overdue-tag"},Ht={class:"detail-row"},jt={class:"detail-value"},Kt={class:"detail-section"},Qt={class:"fee-items-table"},Wt={class:"detail-section"},Xt={class:"payments-table"},Yt={class:"transaction-id"},Zt={key:0},$t={class:"modal-footer"},el={key:2,class:"modal"},tl={class:"modal-content"},ll={class:"modal-header"},sl={class:"modal-body"},ol={class:"form-group"},nl={class:"form-group"},al={class:"form-group"},dl={class:"form-group"},il={class:"fee-items-container"},rl=["onUpdate:modelValue"],ul=["onUpdate:modelValue"],ml=["onClick","disabled"],vl={class:"form-group",style:{"margin-top":"10px"}},fl=["value"],cl={class:"modal-footer"};function pl(U,t,k,l,V,x){var E,i,C,T,_,g,B,v;return r(),u("div",ye,[e("div",ge,[e("button",{class:"btn btn-back",onClick:t[0]||(t[0]=(...s)=>l.goBack&&l.goBack(...s))},"è¿”å›é¦–é¡µ"),t[31]||(t[31]=e("h2",null,"ç‰©ä¸šè´¹è´¦å•ç®¡ç†",-1))]),e("div",De,[e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=s=>l.showGenerateModal=!0)},[...t[32]||(t[32]=[e("i",{class:"icon"},"+",-1),S(" æ‰¹é‡ç”Ÿæˆè´¦å• ",-1)])]),e("button",{class:"btn btn-secondary",onClick:t[2]||(t[2]=(...s)=>l.refreshBills&&l.refreshBills(...s))},[...t[33]||(t[33]=[e("i",{class:"icon"},"ğŸ”„",-1),S(" åˆ·æ–°æ•°æ® ",-1)])]),e("button",{class:"btn btn-success",onClick:t[3]||(t[3]=(...s)=>l.exportBills&&l.exportBills(...s))},[...t[34]||(t[34]=[e("i",{class:"icon"},"ğŸ“¤",-1),S(" å¯¼å‡ºè´¦å• ",-1)])])]),e("div",we,[e("div",Ie,[t[36]||(t[36]=e("label",{for:"bill-status"},"è´¦å•çŠ¶æ€ï¼š",-1)),c(e("select",{id:"bill-status","onUpdate:modelValue":t[4]||(t[4]=s=>l.filter.status=s)},[...t[35]||(t[35]=[fe('<option value="" data-v-b3361dff>å…¨éƒ¨</option><option value="unpaid" data-v-b3361dff>æœªæ”¯ä»˜</option><option value="paid" data-v-b3361dff>å·²æ”¯ä»˜</option><option value="overdue" data-v-b3361dff>é€¾æœŸ</option><option value="partially_paid" data-v-b3361dff>éƒ¨åˆ†æ”¯ä»˜</option>',5)])],512),[[M,l.filter.status]])]),e("div",ke,[t[37]||(t[37]=e("label",{for:"start-period"},"å¼€å§‹å‘¨æœŸï¼š",-1)),c(e("input",{type:"date",id:"start-period","onUpdate:modelValue":t[5]||(t[5]=s=>l.filter.startDate=s)},null,512),[[y,l.filter.startDate]])]),e("div",Fe,[t[38]||(t[38]=e("label",{for:"end-period"},"ç»“æŸå‘¨æœŸï¼š",-1)),c(e("input",{type:"date",id:"end-period","onUpdate:modelValue":t[6]||(t[6]=s=>l.filter.endDate=s)},null,512),[[y,l.filter.endDate]])]),e("div",_e,[e("button",{class:"btn btn-primary",onClick:t[7]||(t[7]=(...s)=>l.getBills&&l.getBills(...s))},"æŸ¥è¯¢"),e("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=(...s)=>l.resetFilter&&l.resetFilter(...s))},"é‡ç½®")])]),e("div",Be,[e("table",Se,[t[39]||(t[39]=e("thead",null,[e("tr",null,[e("th",null,"è´¦å•ID"),e("th",null,"å±…æ°‘ID"),e("th",null,"è´¹ç”¨å‘¨æœŸ"),e("th",null,"æ€»é‡‘é¢"),e("th",null,"çŠ¶æ€"),e("th",null,"æˆªæ­¢æ—¥æœŸ"),e("th",null,"åˆ›å»ºæ—¶é—´"),e("th",null,"æ“ä½œ")])],-1)),e("tbody",null,[(r(!0),u(D,null,w(l.bills,s=>(r(),u("tr",{key:s.id},[e("td",null,n(s.id),1),e("td",null,n(s.userId),1),e("td",null,n(l.formatDate(s.periodStart))+" - "+n(l.formatDate(s.periodEnd)),1),e("td",null,"Â¥"+n(s.amount.toFixed(2)),1),e("td",null,[e("span",{class:O(["bill-status",s.status])},n(l.getStatusText(s.status)),3)]),e("td",null,n(l.formatDate(s.dueDate)),1),e("td",null,n(l.formatDateTime(s.createdAt)),1),e("td",Ce,[e("button",{class:"btn btn-view",onClick:m=>l.viewBillDetails(s)}," è¯¦æƒ… ",8,Te),e("button",{class:"btn btn-edit",onClick:m=>l.editBill(s)}," ä¿®æ”¹ ",8,he),e("button",{class:"btn btn-danger",onClick:m=>l.deleteBill(s.id)}," åˆ é™¤ ",8,xe),e("button",{class:"btn btn-remind",onClick:m=>l.sendReminder(s),disabled:s.paymentDeadlineReminderSent||!1,title:"å‘é€å‚¬ç¼´æé†’"}," å‚¬ç¼´ ",8,Ee)])]))),128))])]),l.bills.length===0?(r(),u("div",Me,[...t[40]||(t[40]=[e("p",null,"æš‚æ— è´¦å•æ•°æ®",-1)])])):I("",!0)]),l.showGenerateModal?(r(),u("div",Ue,[e("div",Ve,[e("div",Ae,[t[41]||(t[41]=e("h3",null,"æ‰¹é‡ç”Ÿæˆè´¦å•",-1)),e("button",{class:"close-btn",onClick:t[9]||(t[9]=s=>l.showGenerateModal=!1)},"Ã—")]),e("div",Ne,[e("div",Pe,[t[44]||(t[44]=e("label",null,"è´¹ç”¨æ•°æ®å¯¼å…¥ï¼š",-1)),e("div",Ge,[e("input",{type:"file",id:"fee-import",accept:".csv,.xlsx",onChange:t[10]||(t[10]=(...s)=>l.handleFileImport&&l.handleFileImport(...s)),ref:"fileInput"},null,544),e("button",{class:"btn btn-secondary",onClick:t[11]||(t[11]=s=>{var m;return(m=U.$refs.fileInput)==null?void 0:m.click()})},[...t[42]||(t[42]=[e("i",{class:"icon"},"ğŸ“",-1),S(" é€‰æ‹©æ–‡ä»¶å¯¼å…¥ ",-1)])]),t[43]||(t[43]=e("p",{class:"help-text"},"æ”¯æŒCSVå’ŒExcelæ ¼å¼æ–‡ä»¶å¯¼å…¥è´¹ç”¨æ•°æ®",-1))])]),e("div",Re,[t[45]||(t[45]=e("label",{for:"period-start"},"è´¹ç”¨å‘¨æœŸå¼€å§‹æ—¥æœŸï¼š",-1)),c(e("input",{type:"date",id:"period-start","onUpdate:modelValue":t[12]||(t[12]=s=>l.generateForm.periodStart=s),required:""},null,512),[[y,l.generateForm.periodStart]])]),e("div",qe,[t[46]||(t[46]=e("label",{for:"period-end"},"è´¹ç”¨å‘¨æœŸç»“æŸæ—¥æœŸï¼š",-1)),c(e("input",{type:"date",id:"period-end","onUpdate:modelValue":t[13]||(t[13]=s=>l.generateForm.periodEnd=s),required:""},null,512),[[y,l.generateForm.periodEnd]])]),e("div",Oe,[t[47]||(t[47]=e("label",{for:"due-date"},"ç¼´è´¹æˆªæ­¢æ—¥æœŸï¼š",-1)),c(e("input",{type:"date",id:"due-date","onUpdate:modelValue":t[14]||(t[14]=s=>l.generateForm.dueDate=s),required:""},null,512),[[y,l.generateForm.dueDate]])]),e("div",Je,[t[48]||(t[48]=e("label",{for:"fee-items"},"è´¹ç”¨é¡¹ç›®ï¼š",-1)),e("div",ze,[(r(!0),u(D,null,w(l.generateForm.feeItems,(s,m)=>(r(),u("div",{class:"fee-item-row",key:m},[c(e("input",{type:"text","onUpdate:modelValue":f=>s.name=f,placeholder:"è´¹ç”¨åç§°ï¼ˆå¦‚ï¼šç‰©ä¸šè´¹ï¼‰",required:""},null,8,Le),[[y,s.name]]),c(e("input",{type:"number","onUpdate:modelValue":f=>s.amount=f,placeholder:"é‡‘é¢",step:"0.01",required:""},null,8,He),[[y,s.amount]]),e("button",{class:"btn btn-remove",onClick:f=>l.removeFeeItem(m),disabled:l.generateForm.feeItems.length<=1}," - ç§»é™¤ ",8,je)]))),128)),e("button",{class:"btn btn-add",onClick:t[15]||(t[15]=(...s)=>l.addFeeItem&&l.addFeeItem(...s))}," + æ·»åŠ è´¹ç”¨é¡¹ç›® ")])]),e("div",Ke,[t[50]||(t[50]=e("label",{for:"bill-type"},"ç”ŸæˆèŒƒå›´ï¼š",-1)),c(e("select",{id:"bill-type","onUpdate:modelValue":t[16]||(t[16]=s=>l.generateForm.billType=s)},[...t[49]||(t[49]=[e("option",{value:"all"},"æ‰€æœ‰å±…æ°‘",-1),e("option",{value:"selected"},"é€‰æ‹©å±…æ°‘",-1)])],512),[[M,l.generateForm.billType]])]),l.generateForm.billType==="selected"?(r(),u("div",Qe,[t[51]||(t[51]=e("label",{for:"selected-users"},"é€‰æ‹©å±…æ°‘ï¼š",-1)),c(e("select",{id:"selected-users",multiple:"","onUpdate:modelValue":t[17]||(t[17]=s=>l.generateForm.selectedUsers=s)},[(r(!0),u(D,null,w(l.residents,s=>(r(),u("option",{key:s.id,value:s.id},n(s.id)+" - "+n(s.realName)+" ("+n(s.address)+") ",9,We))),128))],512),[[M,l.generateForm.selectedUsers]])])):I("",!0),e("div",Xe,[t[56]||(t[56]=e("h4",null,"é¢„è§ˆç”Ÿæˆç»“æœï¼š",-1)),e("div",Ye,[t[52]||(t[52]=e("span",null,"é¢„è®¡ç”Ÿæˆè´¦å•æ•°é‡ï¼š",-1)),e("span",Ze,n(l.getPreviewCount())+" ä»½",1)]),e("div",$e,[t[53]||(t[53]=e("span",null,"è´¹ç”¨é¡¹ç›®æ€»è®¡ï¼š",-1)),e("span",et,n(l.getTotalAmountPerBill())+" é¡¹",1)]),e("div",tt,[t[54]||(t[54]=e("span",null,"æ¯ä»½è´¦å•æ€»é‡‘é¢ï¼š",-1)),e("span",lt,"Â¥"+n(l.calculateTotalAmount()),1)]),e("button",{class:"btn btn-secondary",onClick:t[18]||(t[18]=(...s)=>l.previewGeneration&&l.previewGeneration(...s)),style:{"margin-top":"10px"}},[...t[55]||(t[55]=[e("i",{class:"icon"},"ğŸ‘ï¸",-1),S(" ç”Ÿæˆè¯¦ç»†é¢„è§ˆ ",-1)])])]),l.showPreviewTable?(r(),u("div",st,[t[58]||(t[58]=e("h4",null,"è¯¦ç»†é¢„è§ˆï¼š",-1)),e("div",ot,[e("table",nt,[t[57]||(t[57]=e("thead",null,[e("tr",null,[e("th",null,"å±…æ°‘å§“å"),e("th",null,"åœ°å€"),e("th",null,"è´¹ç”¨å‘¨æœŸ"),e("th",null,"æˆªæ­¢æ—¥æœŸ"),e("th",null,"æ€»é‡‘é¢"),e("th",null,"è´¹ç”¨æ˜ç»†")])],-1)),e("tbody",null,[(r(!0),u(D,null,w(l.previewData,(s,m)=>(r(),u("tr",{key:m},[e("td",null,n(s.userName),1),e("td",null,n(s.userAddress),1),e("td",null,n(l.formatDate(s.periodStart))+" - "+n(l.formatDate(s.periodEnd)),1),e("td",null,n(l.formatDate(s.dueDate)),1),e("td",null,"Â¥"+n(s.totalAmount.toFixed(2)),1),e("td",null,[e("ul",at,[(r(!0),u(D,null,w(s.feeItems,(f,A)=>(r(),u("li",{key:A},n(f.name)+": Â¥"+n(f.amount.toFixed(2)),1))),128))])])]))),128))])])])])):I("",!0)]),e("div",dt,[e("button",{class:"btn btn-secondary",onClick:t[19]||(t[19]=s=>l.showGenerateModal=!1)},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:t[20]||(t[20]=(...s)=>l.generateBills&&l.generateBills(...s)),disabled:l.isGenerating},n(l.isGenerating?"ç”Ÿæˆä¸­...":"ç¡®è®¤ç”Ÿæˆ"),9,it)])])])):I("",!0),l.showDetailModal?(r(),u("div",rt,[e("div",ut,[e("div",mt,[e("div",vt,[e("button",{class:"btn btn-back",onClick:t[21]||(t[21]=s=>l.showDetailModal=!1)}," è¿”å› "),t[59]||(t[59]=e("h3",null,"è´¦å•è¯¦æƒ…",-1))]),e("button",{class:"close-btn",onClick:t[22]||(t[22]=s=>l.showDetailModal=!1)},"Ã—")]),e("div",ft,[e("div",ct,[t[68]||(t[68]=e("h4",null,"å±…æ°‘ä¿¡æ¯ï¼š",-1)),e("div",pt,[e("div",bt,[t[60]||(t[60]=e("div",{class:"detail-label"},"ç”¨æˆ·åï¼š",-1)),e("div",yt,n(((E=l.selectedBill.resident)==null?void 0:E.username)||"æœªçŸ¥"),1)]),e("div",gt,[t[61]||(t[61]=e("div",{class:"detail-label"},"å§“åï¼š",-1)),e("div",Dt,n(((i=l.selectedBill.resident)==null?void 0:i.realName)||"æœªçŸ¥"),1)]),e("div",wt,[t[62]||(t[62]=e("div",{class:"detail-label"},"æ‰‹æœºå·ï¼š",-1)),e("div",It,n(((C=l.selectedBill.resident)==null?void 0:C.phone)||"æœªçŸ¥"),1)]),e("div",kt,[t[63]||(t[63]=e("div",{class:"detail-label"},"é‚®ç®±ï¼š",-1)),e("div",Ft,n(((T=l.selectedBill.resident)==null?void 0:T.email)||"æœªçŸ¥"),1)]),e("div",_t,[t[64]||(t[64]=e("div",{class:"detail-label"},"åœ°å€ï¼š",-1)),e("div",Bt,n(((_=l.selectedBill.resident)==null?void 0:_.address)||"æœªçŸ¥"),1)]),e("div",St,[t[65]||(t[65]=e("div",{class:"detail-label"},"èº«ä»½è¯å·ï¼š",-1)),e("div",Ct,n(((g=l.selectedBill.resident)==null?void 0:g.idCard)||"æœªçŸ¥"),1)]),e("div",Tt,[t[66]||(t[66]=e("div",{class:"detail-label"},"æ³¨å†Œæ—¶é—´ï¼š",-1)),e("div",ht,n(l.formatDateTime((B=l.selectedBill.resident)==null?void 0:B.createdAt)),1)]),e("div",xt,[t[67]||(t[67]=e("div",{class:"detail-label"},"ç”¨æˆ·çŠ¶æ€ï¼š",-1)),e("div",Et,n(((v=l.selectedBill.resident)==null?void 0:v.status)===1?"å¯ç”¨":"ç¦ç”¨"),1)])])]),e("div",Mt,[t[69]||(t[69]=e("div",{class:"detail-label"},"è´¦å•IDï¼š",-1)),e("div",Ut,n(l.selectedBill.id),1)]),e("div",Vt,[t[70]||(t[70]=e("div",{class:"detail-label"},"å±…æ°‘IDï¼š",-1)),e("div",At,n(l.selectedBill.userId),1)]),e("div",Nt,[t[71]||(t[71]=e("div",{class:"detail-label"},"è´¹ç”¨å‘¨æœŸï¼š",-1)),e("div",Pt,n(l.formatDate(l.selectedBill.periodStart))+" è‡³ "+n(l.formatDate(l.selectedBill.periodEnd)),1)]),e("div",Gt,[t[72]||(t[72]=e("div",{class:"detail-label"},"æ€»é‡‘é¢ï¼š",-1)),e("div",Rt,"Â¥"+n(l.selectedBill.amount.toFixed(2)),1)]),e("div",qt,[t[73]||(t[73]=e("div",{class:"detail-label"},"è´¦å•çŠ¶æ€ï¼š",-1)),e("div",Ot,[e("span",{class:O(["bill-status",l.selectedBill.status])},n(l.getStatusText(l.selectedBill.status)),3)])]),e("div",Jt,[t[74]||(t[74]=e("div",{class:"detail-label"},"ç¼´è´¹æˆªæ­¢æ—¥æœŸï¼š",-1)),e("div",zt,[S(n(l.formatDate(l.selectedBill.dueDate))+" ",1),l.selectedBill.status==="overdue"?(r(),u("span",Lt,"å·²é€¾æœŸ")):I("",!0)])]),e("div",Ht,[t[75]||(t[75]=e("div",{class:"detail-label"},"å‚¬ç¼´æé†’ï¼š",-1)),e("div",jt,n(l.selectedBill.paymentDeadlineReminderSent?"å·²å‘é€":"æœªå‘é€"),1)]),e("div",Kt,[t[77]||(t[77]=e("h4",null,"è´¹ç”¨æ˜ç»†ï¼š",-1)),e("table",Qt,[t[76]||(t[76]=e("thead",null,[e("tr",null,[e("th",null,"è´¹ç”¨é¡¹ç›®"),e("th",null,"é‡‘é¢")])],-1)),e("tbody",null,[(r(!0),u(D,null,w(l.selectedBill.items?JSON.parse(l.selectedBill.items):[{name:"ç‰©ä¸šè´¹",amount:l.selectedBill.amount}],(s,m)=>(r(),u("tr",{key:m},[e("td",null,n(s.name),1),e("td",null,"Â¥"+n(s.amount.toFixed(2)),1)]))),128))])])]),e("div",Wt,[t[80]||(t[80]=e("h4",null,"ç›¸å…³æ”¯ä»˜è®°å½•ï¼š",-1)),e("table",Xt,[t[79]||(t[79]=e("thead",null,[e("tr",null,[e("th",null,"æ”¯ä»˜ID"),e("th",null,"äº¤æ˜“ID"),e("th",null,"æ”¯ä»˜é‡‘é¢"),e("th",null,"æ”¯ä»˜æ–¹å¼"),e("th",null,"æ”¯ä»˜æ—¶é—´"),e("th",null,"çŠ¶æ€")])],-1)),e("tbody",null,[(r(!0),u(D,null,w(l.selectedBill.payments||[],s=>(r(),u("tr",{key:s.id},[e("td",null,n(s.id),1),e("td",Yt,n(s.transactionId),1),e("td",null,"Â¥"+n(s.amount.toFixed(2)),1),e("td",null,n(l.getPaymentMethodText(s.paymentMethod)),1),e("td",null,n(l.formatDateTime(s.paymentTime)),1),e("td",null,[e("span",{class:O(["payment-status",s.status])},n(l.getPaymentStatusText(s.status)),3)])]))),128)),(l.selectedBill.payments||[]).length===0?(r(),u("tr",Zt,[...t[78]||(t[78]=[e("td",{colspan:"6",class:"no-data"},"æš‚æ— æ”¯ä»˜è®°å½•",-1)])])):I("",!0)])])])]),e("div",$t,[e("button",{class:"btn btn-primary",onClick:t[23]||(t[23]=s=>l.showDetailModal=!1)},"å…³é—­")])])])):I("",!0),l.showEditModal?(r(),u("div",el,[e("div",tl,[e("div",ll,[t[81]||(t[81]=e("h3",null,"ä¿®æ”¹è´¦å•",-1)),e("button",{class:"close-btn",onClick:t[24]||(t[24]=s=>l.showEditModal=!1)},"Ã—")]),e("div",sl,[e("div",ol,[t[83]||(t[83]=e("label",{for:"edit-status"},"è´¦å•çŠ¶æ€ï¼š",-1)),c(e("select",{id:"edit-status","onUpdate:modelValue":t[25]||(t[25]=s=>l.editForm.status=s)},[...t[82]||(t[82]=[e("option",{value:"unpaid"},"æœªæ”¯ä»˜",-1),e("option",{value:"paid"},"å·²æ”¯ä»˜",-1),e("option",{value:"overdue"},"é€¾æœŸ",-1),e("option",{value:"partially_paid"},"éƒ¨åˆ†æ”¯ä»˜",-1)])],512),[[M,l.editForm.status]])]),e("div",nl,[t[84]||(t[84]=e("label",{for:"edit-due-date"},"ç¼´è´¹æˆªæ­¢æ—¥æœŸï¼š",-1)),c(e("input",{type:"date",id:"edit-due-date","onUpdate:modelValue":t[26]||(t[26]=s=>l.editForm.dueDate=s),required:""},null,512),[[y,l.editForm.dueDate]])]),e("div",al,[t[85]||(t[85]=e("label",{for:"edit-reminder"},"å‚¬ç¼´æé†’ï¼š",-1)),c(e("input",{type:"checkbox",id:"edit-reminder","onUpdate:modelValue":t[27]||(t[27]=s=>l.editForm.paymentDeadlineReminderSent=s)},null,512),[[ce,l.editForm.paymentDeadlineReminderSent]]),t[86]||(t[86]=e("span",null,"å·²å‘é€å‚¬ç¼´æé†’",-1))]),e("div",dl,[t[87]||(t[87]=e("label",{for:"edit-fee-items"},"è´¹ç”¨é¡¹ç›®ï¼š",-1)),e("div",il,[(r(!0),u(D,null,w(l.editForm.feeItems,(s,m)=>(r(),u("div",{class:"fee-item-row",key:m},[c(e("input",{type:"text","onUpdate:modelValue":f=>s.name=f,placeholder:"è´¹ç”¨åç§°ï¼ˆå¦‚ï¼šç‰©ä¸šè´¹ï¼‰",required:""},null,8,rl),[[y,s.name]]),c(e("input",{type:"number","onUpdate:modelValue":f=>s.amount=f,placeholder:"é‡‘é¢",step:"0.01",required:""},null,8,ul),[[y,s.amount]]),e("button",{class:"btn btn-remove",onClick:f=>l.removeEditFeeItem(m),disabled:l.editForm.feeItems.length<=1}," - ç§»é™¤ ",8,ml)]))),128)),e("button",{class:"btn btn-add",onClick:t[28]||(t[28]=(...s)=>l.addEditFeeItem&&l.addEditFeeItem(...s))}," + æ·»åŠ è´¹ç”¨é¡¹ç›® ")])]),e("div",vl,[t[88]||(t[88]=e("label",{for:"auto-amount"},"æ€»é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰ï¼š",-1)),e("input",{type:"number",id:"auto-amount",value:l.calculateEditTotalAmount(),step:"0.01",readonly:"",style:{"background-color":"#f5f5f5"}},null,8,fl)])]),e("div",cl,[e("button",{class:"btn btn-secondary",onClick:t[29]||(t[29]=s=>l.showEditModal=!1)},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:t[30]||(t[30]=(...s)=>l.saveEdit&&l.saveEdit(...s))},"ä¿å­˜ä¿®æ”¹")])])])):I("",!0)])}const gl=me(be,[["render",pl],["__scopeId","data-v-b3361dff"]]);export{gl as default};
//# sourceMappingURL=AdminPropertyFeeManagement-6863947e.js.map
