import{_ as O,u as X,p as i,x as z,o as a,c,a as e,e as x,v as T,h as j,t as l,n as v,f as u,m as A,F,i as D}from"./index-1ef266be.js";import{p as h}from"./api-5fa05d82.js";const q={name:"AdminPropertyFeeReconciliation",setup(){const C=X(),t=i({date:new Date().toISOString().split("T")[0],channel:"all"}),R=i(new Date().toISOString().split("T")[0]),n=i(!1),m=i(null),f=i(null),s=i([]),d=i(""),E=i(!1),g=i([]),b=i(1),w=i(1),_=i(!1),k=i([]),y=i(!1),p=i(null),M=async()=>{if(!t.value.date){m.value={success:!1,message:"请选择对账日期"};return}n.value=!0;try{const o=await h.startReconciliation(t.value);m.value={success:o.code==="success",message:o.message},o.code==="success"&&(f.value={reconciliationDate:t.value.date,channel:t.value.channel,systemTransactionCount:100,channelTransactionCount:100,matchedCount:98,unmatchedCount:2,systemAmount:25e3,channelAmount:24998.5,amountDifference:-1.5,status:"partial",createdAt:new Date().toLocaleString()},s.value=[{transactionId:"TXN20260101000001",channel:t.value.channel,transactionTime:"2026-01-01 10:30:00",systemAmount:150,channelAmount:149.5,differenceReason:"金额不符",status:"pending"},{transactionId:"TXN20260101000002",channel:t.value.channel,transactionTime:"2026-01-01 14:20:00",systemAmount:200,channelAmount:0,differenceReason:"系统记录但渠道无记录",status:"pending"}],w.value=Math.ceil(s.value.length/10))}catch{m.value={success:!1,message:"对账失败，请稍后重试"}}finally{n.value=!1}},P=async()=>{try{const o=await h.getReconciliationHistory();o.code==="success"&&(k.value=o.data,_.value=!0)}catch(o){console.error("获取对账历史失败:",o)}},I=o=>{console.log("查看历史详情:",o)},H=o=>{console.log("删除对账历史:",o)},N=()=>{if(g.value.length===0){alert("请选择要处理的异常交易");return}console.log("处理异常交易:",g.value)},U=o=>{p.value=o,y.value=!0},B=async()=>{if(p.value)try{if((await h.resolveException(p.value.transactionId)).code==="success"){const r=s.value.findIndex(L=>L.transactionId===p.value.transactionId);r!==-1&&(s.value[r].status="resolved"),y.value=!1,alert("异常交易已标记为已处理")}}catch(o){console.error("处理异常交易失败:",o),alert("处理异常交易失败")}},V=()=>{E.value?g.value=[...S]:g.value=[]},S=z(()=>{if(!d.value)return s.value;const o=d.value.toLowerCase();return s.value.filter(r=>r.transactionId.toLowerCase().includes(o)||r.channel.toLowerCase().includes(o)||r.differenceReason.toLowerCase().includes(o))});return{reconciliationForm:t,today:R,reconciling:n,reconciliationResult:m,currentReconciliation:f,unmatchedTransactions:s,exceptionFilter:d,selectAllExceptions:E,selectedExceptions:g,currentPage:b,totalPages:w,showHistory:_,reconciliationHistory:k,showExceptionModal:y,selectedException:p,filteredUnmatchedTransactions:S,startReconciliation:M,viewReconciliationHistory:P,viewHistoryDetail:I,deleteReconciliationHistory:H,handleExceptionTransactions:N,viewExceptionDetail:U,resolveException:B,toggleSelectAll:V,getChannelName:o=>({all:"全部渠道",wechat:"微信支付",alipay:"支付宝",bank:"银行转账"})[o]||o,getReconciliationStatusClass:o=>({success:"success",partial:"warning",failed:"error"})[o]||"",getReconciliationStatusText:o=>({success:"对账成功",partial:"部分匹配",failed:"对账失败"})[o]||o,getExceptionStatusClass:o=>({pending:"warning",resolved:"success",ignored:"info"})[o]||"",getExceptionStatusText:o=>({pending:"待处理",resolved:"已处理",ignored:"已忽略"})[o]||o,getExceptionSuggestion:o=>o.includes("金额不符")?"请核实交易金额，联系支付渠道确认":o.includes("交易不存在")?"请检查交易是否已被撤销或退款":o.includes("重复交易")?"请核实是否为重复支付，如需退款请联系财务":"请根据实际情况处理",prevPage:()=>{b.value>1&&b.value--},nextPage:()=>{b.value<w.value&&b.value++},goBack:()=>{C.push("/admin")}}}},G={class:"admin-reconciliation-container"},J={class:"header-section"},K={class:"reconciliation-operation"},Q={class:"operation-form"},W={class:"form-item"},Y=["max"],Z={class:"form-item"},$={class:"form-item"},ee=["disabled"],te={key:0,class:"reconciliation-overview"},ne={class:"overview-grid"},se={class:"overview-item"},oe={class:"overview-value"},le={class:"overview-item"},ie={class:"overview-value"},ae={class:"overview-item"},ce={class:"overview-value"},re={class:"overview-item"},de={class:"overview-value"},ue={class:"overview-item"},ve={class:"overview-value success"},me={class:"overview-item"},ge={class:"overview-value error"},be={class:"overview-item"},pe={class:"overview-value"},xe={class:"overview-item"},fe={class:"overview-value"},we={class:"overview-item"},ye={class:"overview-item"},he={class:"overview-item"},Ce={class:"overview-value"},Re={key:1,class:"exception-section"},Ee={class:"filter-bar"},_e={class:"data-table"},ke=["value"],Se=["onClick"],Te={key:0,class:"pagination"},Ae=["disabled"],Fe=["disabled"],De={key:2,class:"history-section"},Me={class:"data-table"},Pe=["onClick"],Ie=["onClick"],He={key:3,class:"modal"},Ne={class:"modal-content"},Ue={class:"modal-header"},Be={key:0,class:"modal-body"},Ve={class:"detail-item"},Le={class:"detail-value"},Oe={class:"detail-item"},Xe={class:"detail-value"},ze={class:"detail-item"},je={class:"detail-value"},qe={class:"detail-item"},Ge={class:"detail-value"},Je={class:"detail-item"},Ke={class:"detail-value"},Qe={class:"detail-item"},We={class:"detail-value error"},Ye={class:"detail-item"},Ze={class:"detail-value"},$e={class:"detail-item"},et={class:"detail-item"},tt={class:"detail-value"},nt={class:"modal-footer"};function st(C,t,R,n,m,f){return a(),c("div",G,[e("div",J,[e("button",{class:"btn btn-back",onClick:t[0]||(t[0]=(...s)=>n.goBack&&n.goBack(...s))},"返回首页"),t[15]||(t[15]=e("h2",null,"物业费对账管理",-1))]),e("div",K,[t[19]||(t[19]=e("h3",null,"对账操作",-1)),e("div",Q,[e("div",W,[t[16]||(t[16]=e("label",{for:"reconciliationDate"},"对账日期",-1)),x(e("input",{type:"date",id:"reconciliationDate","onUpdate:modelValue":t[1]||(t[1]=s=>n.reconciliationForm.date=s),max:n.today},null,8,Y),[[T,n.reconciliationForm.date]])]),e("div",Z,[t[18]||(t[18]=e("label",{for:"paymentChannel"},"支付渠道",-1)),x(e("select",{id:"paymentChannel","onUpdate:modelValue":t[2]||(t[2]=s=>n.reconciliationForm.channel=s)},[...t[17]||(t[17]=[e("option",{value:"all"},"全部渠道",-1),e("option",{value:"wechat"},"微信支付",-1),e("option",{value:"alipay"},"支付宝",-1),e("option",{value:"bank"},"银行转账",-1)])],512),[[j,n.reconciliationForm.channel]])]),e("div",$,[e("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=(...s)=>n.startReconciliation&&n.startReconciliation(...s)),disabled:n.reconciling},l(n.reconciling?"对账中...":"开始对账"),9,ee),e("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=(...s)=>n.viewReconciliationHistory&&n.viewReconciliationHistory(...s))},"查看历史对账")])]),n.reconciliationResult?(a(),c("p",{key:0,class:v(n.reconciliationResult.success?"success-message":"error-message")},l(n.reconciliationResult.message),3)):u("",!0)]),n.currentReconciliation?(a(),c("div",te,[t[31]||(t[31]=e("h3",null,"对账结果概览",-1)),e("div",ne,[e("div",se,[t[20]||(t[20]=e("span",{class:"overview-label"},"对账日期：",-1)),e("span",oe,l(n.currentReconciliation.reconciliationDate),1)]),e("div",le,[t[21]||(t[21]=e("span",{class:"overview-label"},"支付渠道：",-1)),e("span",ie,l(n.getChannelName(n.currentReconciliation.channel)),1)]),e("div",ae,[t[22]||(t[22]=e("span",{class:"overview-label"},"系统交易笔数：",-1)),e("span",ce,l(n.currentReconciliation.systemTransactionCount),1)]),e("div",re,[t[23]||(t[23]=e("span",{class:"overview-label"},"渠道交易笔数：",-1)),e("span",de,l(n.currentReconciliation.channelTransactionCount),1)]),e("div",ue,[t[24]||(t[24]=e("span",{class:"overview-label"},"匹配成功笔数：",-1)),e("span",ve,l(n.currentReconciliation.matchedCount),1)]),e("div",me,[t[25]||(t[25]=e("span",{class:"overview-label"},"匹配失败笔数：",-1)),e("span",ge,l(n.currentReconciliation.unmatchedCount),1)]),e("div",be,[t[26]||(t[26]=e("span",{class:"overview-label"},"系统交易金额：",-1)),e("span",pe,"¥"+l(n.currentReconciliation.systemAmount.toFixed(2)),1)]),e("div",xe,[t[27]||(t[27]=e("span",{class:"overview-label"},"渠道交易金额：",-1)),e("span",fe,"¥"+l(n.currentReconciliation.channelAmount.toFixed(2)),1)]),e("div",we,[t[28]||(t[28]=e("span",{class:"overview-label"},"金额差异：",-1)),e("span",{class:v(["overview-value",Math.abs(n.currentReconciliation.amountDifference)>0?"error":"success"])}," ¥"+l(n.currentReconciliation.amountDifference.toFixed(2)),3)]),e("div",ye,[t[29]||(t[29]=e("span",{class:"overview-label"},"对账状态：",-1)),e("span",{class:v(["overview-value",n.getReconciliationStatusClass(n.currentReconciliation.status)])},l(n.getReconciliationStatusText(n.currentReconciliation.status)),3)]),e("div",he,[t[30]||(t[30]=e("span",{class:"overview-label"},"对账时间：",-1)),e("span",Ce,l(n.currentReconciliation.createdAt),1)])])])):u("",!0),n.unmatchedTransactions.length>0?(a(),c("div",Re,[t[40]||(t[40]=e("h3",null,"异常交易记录",-1)),e("div",Ee,[x(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>n.exceptionFilter=s),placeholder:"搜索异常交易...",class:"search-input"},null,512),[[T,n.exceptionFilter]]),e("button",{class:"btn btn-primary",onClick:t[6]||(t[6]=(...s)=>n.handleExceptionTransactions&&n.handleExceptionTransactions(...s))},"处理异常交易")]),e("table",_e,[e("thead",null,[e("tr",null,[e("th",null,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>n.selectAllExceptions=s),onChange:t[8]||(t[8]=(...s)=>n.toggleSelectAll&&n.toggleSelectAll(...s))},null,544),[[A,n.selectAllExceptions]])]),t[32]||(t[32]=e("th",null,"交易ID",-1)),t[33]||(t[33]=e("th",null,"支付渠道",-1)),t[34]||(t[34]=e("th",null,"交易时间",-1)),t[35]||(t[35]=e("th",null,"系统金额",-1)),t[36]||(t[36]=e("th",null,"渠道金额",-1)),t[37]||(t[37]=e("th",null,"差异原因",-1)),t[38]||(t[38]=e("th",null,"状态",-1)),t[39]||(t[39]=e("th",null,"操作",-1))])]),e("tbody",null,[(a(!0),c(F,null,D(n.filteredUnmatchedTransactions,s=>(a(),c("tr",{key:s.transactionId},[e("td",null,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=d=>n.selectedExceptions=d),value:s},null,8,ke),[[A,n.selectedExceptions]])]),e("td",null,l(s.transactionId),1),e("td",null,l(n.getChannelName(s.channel)),1),e("td",null,l(s.transactionTime),1),e("td",null,"¥"+l(s.systemAmount.toFixed(2)),1),e("td",null,"¥"+l(s.channelAmount.toFixed(2)),1),e("td",null,l(s.differenceReason),1),e("td",{class:v(n.getExceptionStatusClass(s.status))},l(n.getExceptionStatusText(s.status)),3),e("td",null,[e("button",{class:"btn btn-sm btn-warning",onClick:d=>n.viewExceptionDetail(s)},"查看详情",8,Se)])]))),128))])]),n.filteredUnmatchedTransactions.length>0?(a(),c("div",Te,[e("button",{class:"btn btn-sm",onClick:t[10]||(t[10]=(...s)=>n.prevPage&&n.prevPage(...s)),disabled:n.currentPage===1},"上一页",8,Ae),e("span",null,l(n.currentPage)+" / "+l(n.totalPages),1),e("button",{class:"btn btn-sm",onClick:t[11]||(t[11]=(...s)=>n.nextPage&&n.nextPage(...s)),disabled:n.currentPage===n.totalPages},"下一页",8,Fe)])):u("",!0)])):u("",!0),n.showHistory?(a(),c("div",De,[t[42]||(t[42]=e("h3",null,"对账历史记录",-1)),e("table",Me,[t[41]||(t[41]=e("thead",null,[e("tr",null,[e("th",null,"对账日期"),e("th",null,"支付渠道"),e("th",null,"匹配成功"),e("th",null,"匹配失败"),e("th",null,"金额差异"),e("th",null,"对账状态"),e("th",null,"对账时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(a(!0),c(F,null,D(n.reconciliationHistory,s=>(a(),c("tr",{key:s.id},[e("td",null,l(s.reconciliationDate),1),e("td",null,l(n.getChannelName(s.channel)),1),e("td",null,l(s.matchedCount),1),e("td",null,l(s.unmatchedCount),1),e("td",null,"¥"+l(s.amountDifference.toFixed(2)),1),e("td",{class:v(n.getReconciliationStatusClass(s.status))},l(n.getReconciliationStatusText(s.status)),3),e("td",null,l(s.createdAt),1),e("td",null,[e("button",{class:"btn btn-sm btn-info",onClick:d=>n.viewHistoryDetail(s)},"查看详情",8,Pe),e("button",{class:"btn btn-sm btn-danger",onClick:d=>n.deleteReconciliationHistory(s.id)},"删除",8,Ie)])]))),128))])])])):u("",!0),n.showExceptionModal?(a(),c("div",He,[e("div",Ne,[e("div",Ue,[t[43]||(t[43]=e("h4",null,"异常交易详情",-1)),e("button",{class:"close-btn",onClick:t[12]||(t[12]=s=>n.showExceptionModal=!1)},"×")]),n.selectedException?(a(),c("div",Be,[e("div",Ve,[t[44]||(t[44]=e("span",{class:"detail-label"},"交易ID：",-1)),e("span",Le,l(n.selectedException.transactionId),1)]),e("div",Oe,[t[45]||(t[45]=e("span",{class:"detail-label"},"支付渠道：",-1)),e("span",Xe,l(n.getChannelName(n.selectedException.channel)),1)]),e("div",ze,[t[46]||(t[46]=e("span",{class:"detail-label"},"交易时间：",-1)),e("span",je,l(n.selectedException.transactionTime),1)]),e("div",qe,[t[47]||(t[47]=e("span",{class:"detail-label"},"系统记录金额：",-1)),e("span",Ge,"¥"+l(n.selectedException.systemAmount.toFixed(2)),1)]),e("div",Je,[t[48]||(t[48]=e("span",{class:"detail-label"},"渠道记录金额：",-1)),e("span",Ke,"¥"+l(n.selectedException.channelAmount.toFixed(2)),1)]),e("div",Qe,[t[49]||(t[49]=e("span",{class:"detail-label"},"差异金额：",-1)),e("span",We,"¥"+l((n.selectedException.channelAmount-n.selectedException.systemAmount).toFixed(2)),1)]),e("div",Ye,[t[50]||(t[50]=e("span",{class:"detail-label"},"差异原因：",-1)),e("span",Ze,l(n.selectedException.differenceReason),1)]),e("div",$e,[t[51]||(t[51]=e("span",{class:"detail-label"},"当前状态：",-1)),e("span",{class:v(["detail-value",n.getExceptionStatusClass(n.selectedException.status)])},l(n.getExceptionStatusText(n.selectedException.status)),3)]),e("div",et,[t[52]||(t[52]=e("span",{class:"detail-label"},"处理建议：",-1)),e("span",tt,l(n.getExceptionSuggestion(n.selectedException.differenceReason)),1)])])):u("",!0),e("div",nt,[e("button",{class:"btn btn-primary",onClick:t[13]||(t[13]=(...s)=>n.resolveException&&n.resolveException(...s))},"标记为已处理"),e("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=s=>n.showExceptionModal=!1)},"关闭")])])])):u("",!0)])}const bt=O(q,[["render",st],["__scopeId","data-v-36d2aba8"]]);export{bt as default};
//# sourceMappingURL=AdminPropertyFeeReconciliation-7fe400c7.js.map
