import{c}from"./api-5fa05d82.js";import{_ as g,o as r,c as o,a as i,e as d,v as p,h as f,l as b,m,F as _,i as y,t as l,f as h,n as P,d as v}from"./index-1ef266be.js";const A={name:"ResidentActivities",data(){return{activities:[],loading:!1,searchQuery:"",statusFilter:"",currentPage:1,pageSize:10,totalPages:1,isMyActivities:!1}},computed:{currentUserId(){return typeof localStorage<"u"?localStorage.getItem("userId"):""}},mounted(){this.fetchActivities()},methods:{async fetchActivities(){this.loading=!0;try{let s;if(this.isMyActivities){const t=this.currentUserId;if(!t){alert("无法获取用户信息，请重新登录"),this.loading=!1;return}s=await c.getUserActivities(t,this.currentPage,this.pageSize,this.searchQuery,this.statusFilter)}else s=await c.getActivities(this.currentPage,this.pageSize,this.searchQuery,this.statusFilter);s.code==="success"?(this.activities=s.data,this.totalPages=s.totalPages||1):console.error("获取活动列表失败:",s.message)}catch(s){console.error("获取活动列表失败:",s),alert("获取活动列表失败，请稍后重试")}finally{this.loading=!1}},formatDateTime(s){return new Date(s).toLocaleString("zh-CN")},getStatusText(s){return{pending:"待开始",ongoing:"进行中",completed:"已完成",cancelled:"已取消"}[s]||s},handleActivityDetail(s){this.$router.push(`/resident/activities/${s}`)},handlePublishActivity(){this.$router.push("/resident/activities/publish")},handleBack(){this.$router.push("/resident")},handlePrevPage(){this.currentPage>1&&(this.currentPage--,this.fetchActivities())},handleNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchActivities())},handleEditActivity(s){this.$router.push(`/resident/activities/edit/${s}`)},handleDeleteActivity(s){confirm("确定要删除这个活动吗？")&&c.deleteActivity(s).then(t=>{t.code==="success"?(alert("活动删除成功"),this.fetchActivities()):alert(`删除失败: ${t.message}`)}).catch(t=>{console.error("删除活动失败:",t),alert("删除活动失败，请稍后重试")})}}},k={class:"container"},x={class:"header-actions"},C={class:"activities-section"},S={class:"filter-section"},D={class:"checkbox-filter"},M={class:"activities-list"},I={key:0,class:"loading"},N={key:1,class:"no-data"},T=["onClick"],F={class:"activity-date"},U={class:"activity-location"},B={class:"activity-info"},V={key:0,class:"activity-actions"},w=["onClick"],z=["onClick"],Q={key:0,class:"pagination"},E=["disabled"],R=["disabled"];function L(s,t,j,q,n,a){return r(),o("div",k,[i("header",null,[t[8]||(t[8]=i("h1",null,"社区活动",-1)),i("div",x,[i("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>a.handlePublishActivity&&a.handlePublishActivity(...e))},"发布活动"),i("button",{class:"btn",onClick:t[1]||(t[1]=(...e)=>a.handleBack&&a.handleBack(...e))},"返回首页")])]),i("div",C,[i("div",S,[d(i("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>n.searchQuery=e),placeholder:"搜索活动",class:"search-input"},null,512),[[p,n.searchQuery]]),d(i("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.statusFilter=e),class:"filter-select"},[...t[9]||(t[9]=[b('<option value="" data-v-988531b0>全部状态</option><option value="pending" data-v-988531b0>待开始</option><option value="ongoing" data-v-988531b0>进行中</option><option value="completed" data-v-988531b0>已完成</option><option value="cancelled" data-v-988531b0>已取消</option>',5)])],512),[[f,n.statusFilter]]),i("div",D,[d(i("input",{type:"checkbox",id:"myActivities","onUpdate:modelValue":t[4]||(t[4]=e=>n.isMyActivities=e)},null,512),[[m,n.isMyActivities]]),t[10]||(t[10]=i("label",{for:"myActivities"},"只看我发布的活动",-1))]),i("button",{class:"btn",onClick:t[5]||(t[5]=(...e)=>a.fetchActivities&&a.fetchActivities(...e))},"筛选")]),i("div",M,[n.loading?(r(),o("div",I,"加载中...")):n.activities.length===0?(r(),o("div",N,"暂无活动")):(r(!0),o(_,{key:2},y(n.activities,e=>(r(),o("div",{class:"activity-card",key:e.id},[i("div",{class:"activity-content",onClick:u=>a.handleActivityDetail(e.id)},[i("h3",null,l(e.title),1),i("p",F,l(a.formatDateTime(e.startTime))+" - "+l(a.formatDateTime(e.endTime)),1),i("p",U,l(e.location),1),i("p",{class:P(["activity-status",e.status])},l(a.getStatusText(e.status)),3),i("div",B,[i("span",null,"发布者: "+l(e.publisherName||"匿名"),1),i("span",null,"参与人数: "+l(e.currentParticipants)+"/"+l(e.maxParticipants||"无限制"),1)])],8,T),e.userId==a.currentUserId?(r(),o("div",V,[i("button",{class:"btn btn-edit",onClick:v(u=>a.handleEditActivity(e.id),["stop"])},"编辑",8,w),i("button",{class:"btn btn-delete",onClick:v(u=>a.handleDeleteActivity(e.id),["stop"])},"删除",8,z)])):h("",!0)]))),128))]),n.totalPages>1?(r(),o("div",Q,[i("button",{class:"btn",onClick:t[6]||(t[6]=(...e)=>a.handlePrevPage&&a.handlePrevPage(...e)),disabled:n.currentPage===1},"上一页",8,E),i("span",null,l(n.currentPage)+"/"+l(n.totalPages),1),i("button",{class:"btn",onClick:t[7]||(t[7]=(...e)=>a.handleNextPage&&a.handleNextPage(...e)),disabled:n.currentPage===n.totalPages},"下一页",8,R)])):h("",!0)])])}const J=g(A,[["render",L],["__scopeId","data-v-988531b0"]]);export{J as default};
//# sourceMappingURL=ResidentActivities-d5def9a9.js.map
