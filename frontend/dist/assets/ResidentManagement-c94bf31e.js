import{_ as c,o as m,c as h,a as t,t as d,e as a,v as i,h as b,F as y,i as C,d as p,f,n as g}from"./index-1ef266be.js";const F={name:"ResidentManagement",data(){return{username:"",residents:[],showModal:!1,isEditMode:!1,residentForm:{id:"",username:"",password:"",realName:"",phone:"",email:"",idCard:"",address:""},searchKeyword:"",statusFilter:"",timer:null}},mounted(){this.username=this.getLocalStorageItem("username"),this.loadResidents(),this.timer=setInterval(()=>{this.loadResidents()},3e4)},beforeUnmount(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{getLocalStorageItem(o){return typeof localStorage<"u"?localStorage.getItem(o):null},loadResidents(){const o=this.getLocalStorageItem("token"),e=new URLSearchParams;this.searchKeyword&&e.append("searchKeyword",this.searchKeyword),this.statusFilter&&e.append("status",this.statusFilter);const u=e.toString()?`?${e.toString()}`:"";fetch(`/api/residents${u}`,{method:"GET",headers:{Authorization:"Bearer "+o}}).then(n=>{if(!n.ok)throw new Error("获取居民列表失败");return n.json()}).then(n=>{n.status==="success"&&(this.residents=n.data)}).catch(n=>{console.error("获取居民列表失败:",n),alert("获取居民列表失败，请稍后重试")})},handleAddResident(){this.residentForm={id:"",username:"",password:"",realName:"",phone:"",email:"",idCard:"",address:""},this.isEditMode=!1,this.showModal=!0},handleEditResident(o){this.residentForm={id:o.id,username:o.username,password:"",realName:o.realName||"",phone:o.phone||"",email:o.email||"",idCard:o.idCard||"",address:o.address||""},this.isEditMode=!0,this.showModal=!0},handleCloseModal(){this.showModal=!1},handleSubmitResident(){this.isEditMode?this.updateResident():this.addResident()},addResident(){fetch("/api/residents",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getLocalStorageItem("token")},body:JSON.stringify({username:this.residentForm.username,password:this.residentForm.password,realName:this.residentForm.realName,phone:this.residentForm.phone,email:this.residentForm.email,idCard:this.residentForm.idCard,address:this.residentForm.address})}).then(o=>{if(!o.ok)throw new Error("添加居民失败");return o.json()}).then(o=>{o.status==="success"?(alert("居民添加成功"),this.showModal=!1,this.loadResidents()):alert("添加失败: "+o.message)}).catch(o=>{console.error("添加居民失败:",o),alert("添加居民失败，请稍后重试")})},updateResident(){fetch(`/api/residents/${this.residentForm.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getLocalStorageItem("token")},body:JSON.stringify({realName:this.residentForm.realName,phone:this.residentForm.phone,email:this.residentForm.email,idCard:this.residentForm.idCard,address:this.residentForm.address})}).then(o=>{if(!o.ok)throw new Error("更新居民信息失败");return o.json()}).then(o=>{o.status==="success"?(alert("居民信息更新成功"),this.showModal=!1,this.loadResidents()):alert("更新失败: "+o.message)}).catch(o=>{console.error("更新居民信息失败:",o),alert("更新居民信息失败，请稍后重试")})},handleToggleStatus(o){const e=o.status===1?0:1,u=e===1?"启用":"禁用";confirm(`确定要${u}用户"${o.username}"吗？`)&&fetch(`/api/residents/${o.id}?action=status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getLocalStorageItem("token")},body:JSON.stringify({status:e})}).then(n=>{if(!n.ok)throw new Error("更新用户状态失败");return n.json()}).then(n=>{n.status==="success"?(alert(`用户已成功${u}`),this.loadResidents()):alert("更新失败: "+n.message)}).catch(n=>{console.error("更新用户状态失败:",n),alert("更新用户状态失败，请稍后重试")})},handleProfile(){this.$router.push("/admin/profile")},handleLogout(){typeof localStorage<"u"&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("realName"),localStorage.removeItem("phone"),localStorage.removeItem("email"),localStorage.removeItem("address"),localStorage.removeItem("idCard")),this.$router.push("/login")},handleBackToHome(){const o=this.getLocalStorageItem("role");o==="resident"?this.$router.push("/resident"):o==="property_admin"?this.$router.push("/admin"):o==="service_provider"?this.$router.push("/provider"):this.$router.push("/login")}}},w={class:"container"},S={class:"user-info"},k={class:"management-container"},M={class:"management-header"},R={class:"search-filter-container"},I={class:"residents-table-container"},N={class:"residents-table"},E={class:"actions"},T=["onClick"],U=["onClick"],L={class:"modal-header"},x={class:"modal-body"},V={class:"form-group"},B=["disabled"],j={key:0,class:"form-group"},A={class:"form-group"},P={class:"form-group"},K={class:"form-group"},z={class:"form-group"},O={class:"form-group"},q={class:"form-actions"};function D(o,e,u,n,r,l){return m(),h("div",w,[t("header",null,[e[20]||(e[20]=t("h1",null,"居民管理中心",-1)),t("div",S,[t("span",null,"欢迎您，"+d(r.username),1),t("button",{class:"btn",onClick:e[0]||(e[0]=(...s)=>l.handleProfile&&l.handleProfile(...s))},"个人中心"),t("button",{class:"btn",onClick:e[1]||(e[1]=(...s)=>l.handleLogout&&l.handleLogout(...s))},"退出登录"),t("button",{class:"btn",onClick:e[2]||(e[2]=(...s)=>l.handleBackToHome&&l.handleBackToHome(...s))},"返回首页")])]),t("div",k,[t("div",M,[e[22]||(e[22]=t("h2",null,"社区居民用户列表",-1)),t("div",R,[a(t("input",{type:"text",class:"search-input",placeholder:"搜索居民...","onUpdate:modelValue":e[3]||(e[3]=s=>r.searchKeyword=s),onInput:e[4]||(e[4]=(...s)=>l.loadResidents&&l.loadResidents(...s))},null,544),[[i,r.searchKeyword]]),a(t("select",{class:"filter-select","onUpdate:modelValue":e[5]||(e[5]=s=>r.statusFilter=s),onChange:e[6]||(e[6]=(...s)=>l.loadResidents&&l.loadResidents(...s))},[...e[21]||(e[21]=[t("option",{value:""},"全部状态",-1),t("option",{value:"1"},"启用",-1),t("option",{value:"0"},"禁用",-1)])],544),[[b,r.statusFilter]])]),t("button",{class:"btn primary",onClick:e[7]||(e[7]=(...s)=>l.handleAddResident&&l.handleAddResident(...s))},"添加居民用户")]),t("div",I,[t("table",N,[e[23]||(e[23]=t("thead",null,[t("tr",null,[t("th",null,"用户ID"),t("th",null,"用户名"),t("th",null,"真实姓名"),t("th",null,"手机号"),t("th",null,"邮箱"),t("th",null,"身份证号"),t("th",null,"居住地址"),t("th",null,"状态"),t("th",null,"操作")])],-1)),t("tbody",null,[(m(!0),h(y,null,C(r.residents,s=>(m(),h("tr",{key:s.id},[t("td",null,d(s.id),1),t("td",null,d(s.username),1),t("td",null,d(s.realName||"-"),1),t("td",null,d(s.phone||"-"),1),t("td",null,d(s.email||"-"),1),t("td",null,d(s.idCard||"-"),1),t("td",null,d(s.address||"-"),1),t("td",null,[t("span",{class:g({"status-value":!0,active:s.status===1,inactive:s.status===0})},d(s.status===1?"启用":"禁用"),3)]),t("td",E,[t("button",{class:"btn edit-btn",onClick:v=>l.handleEditResident(s)},"编辑",8,T),t("button",{class:g(["btn",{primary:s.status===0,danger:s.status===1}]),onClick:v=>l.handleToggleStatus(s)},d(s.status===1?"禁用":"启用"),11,U)])]))),128))])])])]),r.showModal?(m(),h("div",{key:0,class:"modal-overlay",onClick:e[19]||(e[19]=(...s)=>l.handleCloseModal&&l.handleCloseModal(...s))},[t("div",{class:"modal-container",onClick:e[18]||(e[18]=p(()=>{},["stop"]))},[t("div",L,[t("h3",null,d(r.isEditMode?"编辑居民用户":"添加居民用户"),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=(...s)=>l.handleCloseModal&&l.handleCloseModal(...s))},"×")]),t("div",x,[t("form",{onSubmit:e[17]||(e[17]=p((...s)=>l.handleSubmitResident&&l.handleSubmitResident(...s),["prevent"])),class:"resident-form"},[t("div",V,[e[24]||(e[24]=t("label",{for:"username"},"用户名",-1)),a(t("input",{type:"text",id:"username","onUpdate:modelValue":e[9]||(e[9]=s=>r.residentForm.username=s),disabled:r.isEditMode,placeholder:"请输入用户名",required:""},null,8,B),[[i,r.residentForm.username]])]),r.isEditMode?f("",!0):(m(),h("div",j,[e[25]||(e[25]=t("label",{for:"password"},"密码",-1)),a(t("input",{type:"password",id:"password","onUpdate:modelValue":e[10]||(e[10]=s=>r.residentForm.password=s),placeholder:"请输入密码",required:""},null,512),[[i,r.residentForm.password]])])),t("div",A,[e[26]||(e[26]=t("label",{for:"realName"},"真实姓名",-1)),a(t("input",{type:"text",id:"realName","onUpdate:modelValue":e[11]||(e[11]=s=>r.residentForm.realName=s),placeholder:"请输入真实姓名"},null,512),[[i,r.residentForm.realName]])]),t("div",P,[e[27]||(e[27]=t("label",{for:"phone"},"手机号",-1)),a(t("input",{type:"tel",id:"phone","onUpdate:modelValue":e[12]||(e[12]=s=>r.residentForm.phone=s),placeholder:"请输入手机号"},null,512),[[i,r.residentForm.phone]])]),t("div",K,[e[28]||(e[28]=t("label",{for:"email"},"邮箱",-1)),a(t("input",{type:"email",id:"email","onUpdate:modelValue":e[13]||(e[13]=s=>r.residentForm.email=s),placeholder:"请输入邮箱"},null,512),[[i,r.residentForm.email]])]),t("div",z,[e[29]||(e[29]=t("label",{for:"idCard"},"身份证号",-1)),a(t("input",{type:"text",id:"idCard","onUpdate:modelValue":e[14]||(e[14]=s=>r.residentForm.idCard=s),placeholder:"请输入身份证号"},null,512),[[i,r.residentForm.idCard]])]),t("div",O,[e[30]||(e[30]=t("label",{for:"address"},"居住地址",-1)),a(t("textarea",{id:"address","onUpdate:modelValue":e[15]||(e[15]=s=>r.residentForm.address=s),placeholder:"请输入居住地址",rows:"3"},null,512),[[i,r.residentForm.address]])]),t("div",q,[t("button",{type:"button",class:"btn",onClick:e[16]||(e[16]=(...s)=>l.handleCloseModal&&l.handleCloseModal(...s))},"取消"),e[31]||(e[31]=t("button",{type:"submit",class:"btn primary"},"保存",-1))])],32)])])])):f("",!0)])}const J=c(F,[["render",D],["__scopeId","data-v-aee42c46"]]);export{J as default};
//# sourceMappingURL=ResidentManagement-c94bf31e.js.map
