import{_ as b,o as m,c as h,a as r,t as a,e as i,v as n,h as c,F as C,i as y,d as p,f as v,n as f}from"./index-1ef266be.js";const F={name:"ProviderManagement",data(){return{username:"",providers:[],showModal:!1,isEditMode:!1,providerForm:{id:"",username:"",password:"",realName:"",phone:"",email:"",idCard:"",address:""},searchKeyword:"",statusFilter:"",timer:null}},mounted(){this.username=localStorage.getItem("username"),this.loadProviders(),this.timer=setInterval(()=>{this.loadProviders()},3e4)},beforeUnmount(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{loadProviders(){const t=localStorage.getItem("token"),e=new URLSearchParams;this.searchKeyword&&e.append("searchKeyword",this.searchKeyword),this.statusFilter&&e.append("status",this.statusFilter);const u=e.toString()?`?${e.toString()}`:"";fetch(`/api/providers${u}`,{method:"GET",headers:{Authorization:"Bearer "+t}}).then(d=>{if(!d.ok)throw new Error("获取服务商列表失败");return d.json()}).then(d=>{d.status==="success"&&(this.providers=d.data)}).catch(d=>{console.error("获取服务商列表失败:",d),alert("获取服务商列表失败，请稍后重试")})},handleAddProvider(){this.providerForm={id:"",username:"",password:"",realName:"",phone:"",email:"",idCard:"",address:""},this.isEditMode=!1,this.showModal=!0},handleEditProvider(t){this.providerForm={id:t.id,username:t.username,password:"",realName:t.realName||"",phone:t.phone||"",email:t.email||"",idCard:t.idCard||"",address:t.address||""},this.isEditMode=!0,this.showModal=!0},handleCloseModal(){this.showModal=!1},handleSubmitProvider(){this.isEditMode?this.updateProvider():this.addProvider()},addProvider(){fetch("/api/providers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({username:this.providerForm.username,password:this.providerForm.password,realName:this.providerForm.realName,phone:this.providerForm.phone,email:this.providerForm.email,idCard:this.providerForm.idCard,address:this.providerForm.address})}).then(t=>{if(!t.ok)throw new Error("添加服务商失败");return t.json()}).then(t=>{t.status==="success"?(alert("服务商添加成功"),this.showModal=!1,this.loadProviders()):alert("添加失败: "+t.message)}).catch(t=>{console.error("添加服务商失败:",t),alert("添加服务商失败，请稍后重试")})},updateProvider(){fetch(`/api/providers/${this.providerForm.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({realName:this.providerForm.realName,phone:this.providerForm.phone,email:this.providerForm.email,idCard:this.providerForm.idCard,address:this.providerForm.address})}).then(t=>{if(!t.ok)throw new Error("更新服务商信息失败");return t.json()}).then(t=>{t.status==="success"?(alert("服务商信息更新成功"),this.showModal=!1,this.loadProviders()):alert("更新失败: "+t.message)}).catch(t=>{console.error("更新服务商信息失败:",t),alert("更新服务商信息失败，请稍后重试")})},handleToggleStatus(t){const e=t.status===1?0:1,u=e===1?"启用":"禁用";confirm(`确定要${u}服务商"${t.username}"吗？`)&&fetch(`/api/providers/${t.id}?action=status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({status:e})}).then(d=>{if(!d.ok)throw new Error("更新服务商状态失败");return d.json()}).then(d=>{d.status==="success"?(alert(`服务商已成功${u}`),this.loadProviders()):alert("更新失败: "+d.message)}).catch(d=>{console.error("更新服务商状态失败:",d),alert("更新服务商状态失败，请稍后重试")})},handleProfile(){this.$router.push("/admin/profile")},handleLogout(){localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("realName"),localStorage.removeItem("phone"),localStorage.removeItem("email"),localStorage.removeItem("address"),localStorage.removeItem("idCard"),this.$router.push("/login")},handleBackToHome(){const t=localStorage.getItem("role");t==="resident"?this.$router.push("/resident"):t==="property_admin"?this.$router.push("/admin"):t==="service_provider"?this.$router.push("/provider"):this.$router.push("/login")}}},w={class:"container"},P={class:"user-info"},S={class:"management-container"},k={class:"management-header"},M={class:"search-filter-container"},I={class:"providers-table-container"},N={class:"providers-table"},E={class:"actions"},T=["onClick"],U=["onClick"],x={class:"modal-header"},V={class:"modal-body"},B={class:"form-group"},j=["disabled"],A={key:0,class:"form-group"},K={class:"form-group"},z={class:"form-group"},L={class:"form-group"},O={class:"form-group"},q={class:"form-group"},D={class:"form-actions"};function H(t,e,u,d,s,l){return m(),h("div",w,[r("header",null,[e[20]||(e[20]=r("h1",null,"服务商管理中心",-1)),r("div",P,[r("span",null,"欢迎您，"+a(s.username),1),r("button",{class:"btn",onClick:e[0]||(e[0]=(...o)=>l.handleProfile&&l.handleProfile(...o))},"个人中心"),r("button",{class:"btn",onClick:e[1]||(e[1]=(...o)=>l.handleLogout&&l.handleLogout(...o))},"退出登录"),r("button",{class:"btn",onClick:e[2]||(e[2]=(...o)=>l.handleBackToHome&&l.handleBackToHome(...o))},"返回首页")])]),r("div",S,[r("div",k,[e[22]||(e[22]=r("h2",null,"社区服务商列表",-1)),r("div",M,[i(r("input",{type:"text",class:"search-input",placeholder:"搜索服务商...","onUpdate:modelValue":e[3]||(e[3]=o=>s.searchKeyword=o),onInput:e[4]||(e[4]=(...o)=>l.loadProviders&&l.loadProviders(...o))},null,544),[[n,s.searchKeyword]]),i(r("select",{class:"filter-select","onUpdate:modelValue":e[5]||(e[5]=o=>s.statusFilter=o),onChange:e[6]||(e[6]=(...o)=>l.loadProviders&&l.loadProviders(...o))},[...e[21]||(e[21]=[r("option",{value:""},"全部状态",-1),r("option",{value:"1"},"启用",-1),r("option",{value:"0"},"禁用",-1)])],544),[[c,s.statusFilter]])]),r("button",{class:"btn primary",onClick:e[7]||(e[7]=(...o)=>l.handleAddProvider&&l.handleAddProvider(...o))},"添加服务商")]),r("div",I,[r("table",N,[e[23]||(e[23]=r("thead",null,[r("tr",null,[r("th",null,"用户ID"),r("th",null,"用户名"),r("th",null,"真实姓名"),r("th",null,"手机号"),r("th",null,"邮箱"),r("th",null,"身份证号"),r("th",null,"服务地址"),r("th",null,"状态"),r("th",null,"操作")])],-1)),r("tbody",null,[(m(!0),h(C,null,y(s.providers,o=>(m(),h("tr",{key:o.id},[r("td",null,a(o.id),1),r("td",null,a(o.username),1),r("td",null,a(o.realName||"-"),1),r("td",null,a(o.phone||"-"),1),r("td",null,a(o.email||"-"),1),r("td",null,a(o.idCard||"-"),1),r("td",null,a(o.address||"-"),1),r("td",null,[r("span",{class:f({"status-value":!0,active:o.status===1,inactive:o.status===0})},a(o.status===1?"启用":"禁用"),3)]),r("td",E,[r("button",{class:"btn edit-btn",onClick:g=>l.handleEditProvider(o)},"编辑",8,T),r("button",{class:f(["btn",{primary:o.status===0,danger:o.status===1}]),onClick:g=>l.handleToggleStatus(o)},a(o.status===1?"禁用":"启用"),11,U)])]))),128))])])])]),s.showModal?(m(),h("div",{key:0,class:"modal-overlay",onClick:e[19]||(e[19]=(...o)=>l.handleCloseModal&&l.handleCloseModal(...o))},[r("div",{class:"modal-container",onClick:e[18]||(e[18]=p(()=>{},["stop"]))},[r("div",x,[r("h3",null,a(s.isEditMode?"编辑服务商":"添加服务商"),1),r("button",{class:"close-btn",onClick:e[8]||(e[8]=(...o)=>l.handleCloseModal&&l.handleCloseModal(...o))},"×")]),r("div",V,[r("form",{onSubmit:e[17]||(e[17]=p((...o)=>l.handleSubmitProvider&&l.handleSubmitProvider(...o),["prevent"])),class:"provider-form"},[r("div",B,[e[24]||(e[24]=r("label",{for:"username"},"用户名",-1)),i(r("input",{type:"text",id:"username","onUpdate:modelValue":e[9]||(e[9]=o=>s.providerForm.username=o),disabled:s.isEditMode,placeholder:"请输入用户名",required:""},null,8,j),[[n,s.providerForm.username]])]),s.isEditMode?v("",!0):(m(),h("div",A,[e[25]||(e[25]=r("label",{for:"password"},"密码",-1)),i(r("input",{type:"password",id:"password","onUpdate:modelValue":e[10]||(e[10]=o=>s.providerForm.password=o),placeholder:"请输入密码",required:""},null,512),[[n,s.providerForm.password]])])),r("div",K,[e[26]||(e[26]=r("label",{for:"realName"},"真实姓名",-1)),i(r("input",{type:"text",id:"realName","onUpdate:modelValue":e[11]||(e[11]=o=>s.providerForm.realName=o),placeholder:"请输入真实姓名"},null,512),[[n,s.providerForm.realName]])]),r("div",z,[e[27]||(e[27]=r("label",{for:"phone"},"手机号",-1)),i(r("input",{type:"tel",id:"phone","onUpdate:modelValue":e[12]||(e[12]=o=>s.providerForm.phone=o),placeholder:"请输入手机号"},null,512),[[n,s.providerForm.phone]])]),r("div",L,[e[28]||(e[28]=r("label",{for:"email"},"邮箱",-1)),i(r("input",{type:"email",id:"email","onUpdate:modelValue":e[13]||(e[13]=o=>s.providerForm.email=o),placeholder:"请输入邮箱"},null,512),[[n,s.providerForm.email]])]),r("div",O,[e[29]||(e[29]=r("label",{for:"idCard"},"身份证号",-1)),i(r("input",{type:"text",id:"idCard","onUpdate:modelValue":e[14]||(e[14]=o=>s.providerForm.idCard=o),placeholder:"请输入身份证号"},null,512),[[n,s.providerForm.idCard]])]),r("div",q,[e[30]||(e[30]=r("label",{for:"address"},"服务地址",-1)),i(r("textarea",{id:"address","onUpdate:modelValue":e[15]||(e[15]=o=>s.providerForm.address=o),placeholder:"请输入服务地址",rows:"3"},null,512),[[n,s.providerForm.address]])]),r("div",D,[r("button",{type:"button",class:"btn",onClick:e[16]||(e[16]=(...o)=>l.handleCloseModal&&l.handleCloseModal(...o))},"取消"),e[31]||(e[31]=r("button",{type:"submit",class:"btn primary"},"保存",-1))])],32)])])])):v("",!0)])}const G=b(F,[["render",H],["__scopeId","data-v-69628168"]]);export{G as default};
//# sourceMappingURL=ProviderManagement-0eb3f189.js.map
