{"version":3,"file":"AdminAnnouncements-a0455948.js","sources":["../../src/views/AdminAnnouncements.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <header>\n      <h1>公告管理</h1>\n      <div class=\"header-actions\">\n        <button class=\"btn btn-primary\" @click=\"handlePublishAnnouncement\">发布公告</button>\n        <button class=\"btn\" @click=\"handleBack\">返回首页</button>\n      </div>\n    </header>\n\n    <div class=\"announcements-section\">\n      <div class=\"filter-section\">\n        <input type=\"text\" v-model=\"searchQuery\" class=\"search-input\" placeholder=\"搜索公告\" />\n        <select v-model=\"statusFilter\" class=\"filter-select\">\n          <option value=\"\">全部状态</option>\n          <option value=\"1\">已发布</option>\n          <option value=\"0\">草稿</option>\n        </select>\n        <button class=\"btn\" @click=\"fetchAnnouncements\">筛选</button>\n      </div>\n\n      <div class=\"announcements-list\">\n        <div v-if=\"loading\" class=\"loading\">加载中...</div>\n        <div v-else-if=\"announcements.length === 0\" class=\"no-data\">暂无公告</div>\n        <div v-else class=\"announcement-card\" v-for=\"announcement in announcements\" :key=\"announcement.id\">\n          <div @click=\"handleAnnouncementDetail(announcement.id)\">\n            <h3>{{ announcement.title }}</h3>\n            <p class=\"announcement-content\">{{ truncateContent(announcement.content) }}</p>\n            <p class=\"announcement-status\" :class=\"getStatusClass(announcement.status)\">{{ getStatusText(announcement.status) }}</p>\n            <div class=\"announcement-info\">\n              <span>发布者: {{ announcement.authorName || '匿名' }}</span>\n              <span>发布时间: {{ formatDateTime(announcement.publishedAt || announcement.createdAt) }}</span>\n            </div>\n          </div>\n          <div class=\"announcement-actions\">\n            <button class=\"btn btn-edit\" @click.stop=\"handleEditAnnouncement(announcement.id)\">编辑</button>\n            <button class=\"btn btn-delete\" @click.stop=\"handleDeleteAnnouncement(announcement.id)\">删除</button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"pagination\" v-if=\"totalPages > 1\">\n        <button class=\"btn\" @click=\"previousPage\" :disabled=\"currentPage === 1\">上一页</button>\n        <span>{{ currentPage }}/{{ totalPages }}</span>\n        <button class=\"btn\" @click=\"nextPage\" :disabled=\"currentPage === totalPages\">下一页</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { announcementApi } from '../services/api';\n\nexport default {\n  name: 'AdminAnnouncements',\n  data() {\n    return {\n      announcements: [],\n      loading: false,\n      searchQuery: '',\n      statusFilter: '',\n      currentPage: 1,\n      pageSize: 10,\n      totalPages: 1\n    }\n  },\n  mounted() {\n    this.fetchAnnouncements();\n  },\n  activated() {\n    // 组件激活时自动刷新数据\n    this.fetchAnnouncements();\n  },\n  methods: {\n    // 上一页\n    previousPage() {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n        this.fetchAnnouncements();\n      }\n    },\n    \n    // 下一页\n    nextPage() {\n      if (this.currentPage < this.totalPages) {\n        this.currentPage++;\n        this.fetchAnnouncements();\n      }\n    },\n    \n    async fetchAnnouncements() {\n      this.loading = true;\n      try {\n        const statusFilter = this.statusFilter !== '' ? parseInt(this.statusFilter) : null;\n        const response = await announcementApi.getAnnouncements(this.currentPage, this.pageSize, this.searchQuery, statusFilter);\n        if (response.code === 'success') {\n          this.announcements = response.data;\n          this.totalPages = response.totalPages || 1;\n        } else {\n          console.error('获取公告列表失败:', response.message);\n        }\n      } catch (error) {\n        console.error('获取公告列表失败:', error);\n        alert('获取公告列表失败，请稍后重试');\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleAnnouncementDetail(announcementId) {\n      this.$router.push(`/admin/announcements/${announcementId}`);\n    },\n    handlePublishAnnouncement() {\n      this.$router.push('/admin/announcements/publish');\n    },\n    handleBack() {\n      this.$router.push('/admin');\n    },\n    handleEditAnnouncement(announcementId) {\n      this.$router.push(`/admin/announcements/edit/${announcementId}`);\n    },\n    async handleDeleteAnnouncement(announcementId) {\n      if (confirm('确定要删除这条公告吗？')) {\n        try {\n          const response = await announcementApi.deleteAnnouncement(announcementId);\n          if (response.code === 'success') {\n            alert('公告删除成功');\n            this.fetchAnnouncements();\n          } else {\n            console.error('删除公告失败:', response.message);\n            alert('删除公告失败');\n          }\n        } catch (error) {\n          console.error('删除公告失败:', error);\n          alert('删除公告失败，请稍后重试');\n        }\n      }\n    },\n    formatDateTime(dateTime) {\n      if (!dateTime) return '';\n      \n      // 如果已经是字符串格式，直接返回（后端已格式化）\n      if (typeof dateTime === 'string') {\n        return dateTime;\n      }\n      \n      // 否则，处理时间戳或日期对象\n      const date = new Date(dateTime);\n      if (isNaN(date.getTime())) {\n        return '';\n      }\n      \n      // 确保格式一致性\n      return date.toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit',\n        hour12: false\n      });\n    },\n    getStatusText(status) {\n      return status === 1 ? '已发布' : '草稿';\n    },\n    getStatusClass(status) {\n      return status === 1 ? 'published' : 'draft';\n    },\n    truncateContent(content) {\n      if (!content) return '';\n      return content.length > 100 ? content.substring(0, 100) + '...' : content;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\nheader {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.header-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.announcements-section {\n  background-color: #fff;\n  border-radius: 8px;\n  padding: 20px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n}\n\n.filter-section {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n  flex-wrap: wrap;\n}\n\n.search-input, .filter-select {\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.search-input {\n  width: 250px;\n}\n\n.announcements-list {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.announcement-card {\n  border: 1px solid #eee;\n  border-radius: 8px;\n  padding: 15px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background-color: #fafafa;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.announcement-card:hover {\n  box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.15);\n  transform: translateY(-2px);\n}\n\n.announcement-card h3 {\n  margin: 0 0 8px 0;\n  color: #333;\n}\n\n.announcement-content {\n  margin: 5px 0;\n  color: #666;\n  font-size: 14px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  line-height: 1.5;\n  height: 3em;\n}\n\n.announcement-status {\n  display: inline-block;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-size: 12px;\n  font-weight: bold;\n  margin: 5px 0;\n}\n\n.announcement-status.published {\n  background-color: #f6ffed;\n  color: #52c41a;\n}\n\n.announcement-status.draft {\n  background-color: #fffbe6;\n  color: #faad14;\n}\n\n.announcement-info {\n  display: flex;\n  gap: 15px;\n  margin-top: 10px;\n  font-size: 14px;\n  color: #888;\n}\n\n.announcement-actions {\n  display: flex;\n  gap: 10px;\n  flex-shrink: 0;\n}\n\n.btn-edit {\n  background-color: #1890ff;\n  color: white;\n}\n\n.btn-delete {\n  background-color: #ff4d4f;\n  color: white;\n}\n\n.pagination {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 20px;\n  gap: 10px;\n}\n\n.loading, .no-data {\n  text-align: center;\n  padding: 50px 0;\n  color: #666;\n}\n</style>"],"names":["_sfc_main","statusFilter","response","announcementApi","error","announcementId","dateTime","date","status","content","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_9","_hoisted_10","_hoisted_11","_openBlock","_createElementBlock","_createElementVNode","_cache","$options","args","$data","$event","_hoisted_6","_hoisted_7","_Fragment","_renderList","announcement","_toDisplayString","_withModifiers","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16"],"mappings":"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"}