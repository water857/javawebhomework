import{u as p}from"./api-5fa05d82.js";import{F as b,v as D,a as m,b as P,c as y,d as k,e as C,f as S}from"./Feedback-02f82bf1.js";import{_ as N,r as I,o as t,c as i,a as e,t as d,n as w,g as h,d as c,e as n,v as u,f,b as M}from"./index-1ef266be.js";const V={name:"ProviderProfile",components:{Feedback:b},data(){return{activeTab:"profile",userData:{username:"",realName:"",phone:"",email:"",address:"",idCard:"",role:"service_provider"},passwordData:{oldPassword:"",newPassword:"",confirmPassword:""},errors:{realName:"",phone:"",email:"",address:"",idCard:"",newPassword:"",confirmPassword:""}}},mounted(){this.loadUserData()},methods:{getLocalStorageItem(r){return typeof localStorage<"u"?localStorage.getItem(r):null},setLocalStorageItem(r,s){typeof localStorage<"u"&&localStorage.setItem(r,s)},async loadUserData(){try{this.$refs.feedback.showLoadingMessage("加载用户信息中...");const r=await p.getUserInfo();(r.code==="success"||r.status==="success")&&(this.userData=r.data,this.setLocalStorageItem("userData",JSON.stringify(r.data)),this.$refs.feedback.showSuccessMessage("用户信息加载成功"))}catch(r){console.error("获取用户资料失败:",r),this.$refs.feedback.showErrorMessage(`获取用户信息失败: ${r.message}`);const s=this.getLocalStorageItem("userData");if(s)this.userData=JSON.parse(s);else{const g=this.getLocalStorageItem("username");this.userData.username=g}}finally{this.$refs.feedback.hideLoading()}},validateProfileForm(){let r=!0;return this.errors={realName:"",phone:"",email:"",address:""},this.userData.realName&&!D(this.userData.realName)&&(this.errors.realName=m.realName,r=!1),this.userData.phone&&!P(this.userData.phone)&&(this.errors.phone=m.phone,r=!1),this.userData.email&&!y(this.userData.email)&&(this.errors.email=m.email,r=!1),this.userData.address&&!k(this.userData.address)&&(this.errors.address=m.address,r=!1),r},async updateProfile(){if(this.validateProfileForm())try{this.$refs.feedback.showLoadingMessage("保存个人资料中...");const r=await p.updateProfile({realName:this.userData.realName,phone:this.userData.phone,email:this.userData.email,address:this.userData.address});r.code==="success"?(localStorage.setItem("userData",JSON.stringify(this.userData)),this.$refs.feedback.showSuccessMessage(r.message||"个人资料已更新")):this.$refs.feedback.showErrorMessage(r.message||"更新失败")}catch(r){console.error("更新个人资料失败:",r),this.$refs.feedback.showErrorMessage(`更新个人资料失败: ${r.message}`)}finally{this.$refs.feedback.hideLoading()}},validateIdCardForm(){let r=!0;return this.errors.idCard="",this.userData.idCard?C(this.userData.idCard)||(this.errors.idCard=m.idCard,r=!1):(this.errors.idCard="请输入身份证号",r=!1),r},async updateIdCard(){if(this.validateIdCardForm())try{this.$refs.feedback.showLoadingMessage("保存身份证信息中...");const r=await p.updateIdCard({idCard:this.userData.idCard});r.code==="success"?(localStorage.setItem("userData",JSON.stringify(this.userData)),this.$refs.feedback.showSuccessMessage(r.message||"身份证信息已更新")):this.$refs.feedback.showErrorMessage(r.message||"更新失败")}catch(r){console.error("更新身份证信息失败:",r),this.$refs.feedback.showErrorMessage(`更新身份证信息失败: ${r.message}`)}finally{this.$refs.feedback.hideLoading()}},validatePasswordForm(){let r=!0;return this.errors={newPassword:"",confirmPassword:""},this.passwordData.oldPassword||(this.$refs.feedback.showErrorMessage("请输入原密码"),r=!1),this.passwordData.newPassword?S(this.passwordData.newPassword)||(this.errors.newPassword=m.password,r=!1):(this.errors.newPassword="请输入新密码",r=!1),this.passwordData.confirmPassword?this.passwordData.newPassword!==this.passwordData.confirmPassword&&(this.errors.confirmPassword=m.confirmPassword,r=!1):(this.errors.confirmPassword="请确认新密码",r=!1),r},async changePassword(){if(this.validatePasswordForm())try{this.$refs.feedback.showLoadingMessage("修改密码中...");const r=await p.changePassword({username:this.userData.username,oldPassword:this.passwordData.oldPassword,newPassword:this.passwordData.newPassword});r.code==="success"?(this.$refs.feedback.showSuccessMessage(r.message||"密码已修改成功"),this.passwordData={oldPassword:"",newPassword:"",confirmPassword:""}):this.$refs.feedback.showErrorMessage(r.message||"修改密码失败")}catch(r){console.error("修改密码失败:",r),this.$refs.feedback.showErrorMessage(`修改密码失败: ${r.message}`)}finally{this.$refs.feedback.hideLoading()}},handleBack(){this.$router.push("/provider")},handleLogout(){localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("role"),localStorage.removeItem("userData"),localStorage.removeItem("passwordTemp"),this.$router.push("/login")}}},L={class:"container"},U={class:"user-info"},T={class:"profile-container"},x={class:"profile-sidebar"},E={class:"profile-content"},F={key:0,class:"tab-content"},B={class:"form-group"},J={class:"form-group"},O={key:0,class:"error-message"},_={class:"form-group"},A={key:0,class:"error-message"},z={class:"form-group"},R={key:0,class:"error-message"},j={class:"form-group"},q={key:0,class:"error-message"},G={class:"form-group"},H={key:1,class:"tab-content"},K={class:"verify-status"},Q={class:"status-item"},W={key:0,class:"status-value"},X={key:1,class:"status-value not-filled"},Y={class:"status-item"},Z={class:"form-group"},$={key:0,class:"error-message"},ss={key:2,class:"tab-content"},es={class:"form-group"},rs={class:"form-group"},as={key:0,class:"error-message"},os={class:"form-group"},ts={key:0,class:"error-message"};function is(r,s,g,ls,a,l){const v=I("Feedback");return t(),i("div",L,[e("header",null,[s[18]||(s[18]=e("h1",null,"服务商个人中心",-1)),e("div",U,[e("span",null,"欢迎您，"+d(a.userData.realName||a.userData.username),1),e("button",{class:"btn",onClick:s[0]||(s[0]=(...o)=>l.handleBack&&l.handleBack(...o))},"返回首页"),e("button",{class:"btn",onClick:s[1]||(s[1]=(...o)=>l.handleLogout&&l.handleLogout(...o))},"退出登录")])]),e("div",T,[e("aside",x,[e("nav",null,[e("ul",null,[e("li",{class:w({active:a.activeTab==="profile"}),onClick:s[2]||(s[2]=o=>a.activeTab="profile")},[...s[19]||(s[19]=[e("i",{class:"icon-user"},null,-1),h(" 个人资料 ",-1)])],2),e("li",{class:w({active:a.activeTab==="verify"}),onClick:s[3]||(s[3]=o=>a.activeTab="verify")},[...s[20]||(s[20]=[e("i",{class:"icon-idcard"},null,-1),h(" 实名认证 ",-1)])],2),e("li",{class:w({active:a.activeTab==="password"}),onClick:s[4]||(s[4]=o=>a.activeTab="password")},[...s[21]||(s[21]=[e("i",{class:"icon-lock"},null,-1),h(" 修改密码 ",-1)])],2)])])]),e("main",E,[a.activeTab==="profile"?(t(),i("div",F,[s[29]||(s[29]=e("h2",null,"个人资料管理",-1)),e("form",{onSubmit:s[11]||(s[11]=c((...o)=>l.updateProfile&&l.updateProfile(...o),["prevent"])),class:"profile-form"},[e("div",B,[s[22]||(s[22]=e("label",{for:"username"},"账号",-1)),n(e("input",{type:"text",id:"username","onUpdate:modelValue":s[5]||(s[5]=o=>a.userData.username=o),disabled:""},null,512),[[u,a.userData.username]])]),e("div",J,[s[23]||(s[23]=e("label",{for:"realName"},"真实姓名",-1)),n(e("input",{type:"text",id:"realName","onUpdate:modelValue":s[6]||(s[6]=o=>a.userData.realName=o),placeholder:"请输入真实姓名"},null,512),[[u,a.userData.realName]]),a.errors.realName?(t(),i("span",O,d(a.errors.realName),1)):f("",!0)]),e("div",_,[s[24]||(s[24]=e("label",{for:"phone"},"手机号",-1)),n(e("input",{type:"tel",id:"phone","onUpdate:modelValue":s[7]||(s[7]=o=>a.userData.phone=o),placeholder:"请输入手机号"},null,512),[[u,a.userData.phone]]),a.errors.phone?(t(),i("span",A,d(a.errors.phone),1)):f("",!0)]),e("div",z,[s[25]||(s[25]=e("label",{for:"email"},"邮箱",-1)),n(e("input",{type:"email",id:"email","onUpdate:modelValue":s[8]||(s[8]=o=>a.userData.email=o),placeholder:"请输入邮箱"},null,512),[[u,a.userData.email]]),a.errors.email?(t(),i("span",R,d(a.errors.email),1)):f("",!0)]),e("div",j,[s[26]||(s[26]=e("label",{for:"address"},"居住地址",-1)),n(e("textarea",{id:"address","onUpdate:modelValue":s[9]||(s[9]=o=>a.userData.address=o),placeholder:"请输入居住地址"},null,512),[[u,a.userData.address]]),a.errors.address?(t(),i("span",q,d(a.errors.address),1)):f("",!0)]),e("div",G,[s[27]||(s[27]=e("label",{for:"role"},"身份",-1)),n(e("input",{type:"text",id:"role","onUpdate:modelValue":s[10]||(s[10]=o=>a.userData.role=o),disabled:""},null,512),[[u,a.userData.role]])]),s[28]||(s[28]=e("button",{type:"submit",class:"btn primary"},"保存修改",-1))],32)])):f("",!0),a.activeTab==="verify"?(t(),i("div",H,[s[34]||(s[34]=e("h2",null,"实名认证状态",-1)),e("div",K,[e("div",Q,[s[30]||(s[30]=e("span",{class:"status-label"},"身份证号：",-1)),a.userData.idCard?(t(),i("span",W,d(a.userData.idCard),1)):(t(),i("span",X,"未填写"))]),e("div",Y,[s[31]||(s[31]=e("span",{class:"status-label"},"认证状态：",-1)),e("span",{class:w({"status-value":!0,verified:a.userData.idCard,"not-verified":!a.userData.idCard})},d(a.userData.idCard?"已认证":"未认证"),3)])]),e("form",{onSubmit:s[13]||(s[13]=c((...o)=>l.updateIdCard&&l.updateIdCard(...o),["prevent"])),class:"id-card-form"},[e("div",Z,[s[32]||(s[32]=e("label",{for:"idCard"},"身份证号",-1)),n(e("input",{type:"text",id:"idCard","onUpdate:modelValue":s[12]||(s[12]=o=>a.userData.idCard=o),placeholder:"请输入身份证号"},null,512),[[u,a.userData.idCard]]),a.errors.idCard?(t(),i("span",$,d(a.errors.idCard),1)):f("",!0)]),s[33]||(s[33]=e("button",{type:"submit",class:"btn primary"},"保存身份证号",-1))],32)])):f("",!0),a.activeTab==="password"?(t(),i("div",ss,[s[39]||(s[39]=e("h2",null,"修改密码",-1)),e("form",{onSubmit:s[17]||(s[17]=c((...o)=>l.changePassword&&l.changePassword(...o),["prevent"])),class:"password-form"},[e("div",es,[s[35]||(s[35]=e("label",{for:"oldPassword"},"原密码",-1)),n(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[14]||(s[14]=o=>a.passwordData.oldPassword=o),placeholder:"请输入原密码"},null,512),[[u,a.passwordData.oldPassword]])]),e("div",rs,[s[36]||(s[36]=e("label",{for:"newPassword"},"新密码",-1)),n(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[15]||(s[15]=o=>a.passwordData.newPassword=o),placeholder:"请输入新密码"},null,512),[[u,a.passwordData.newPassword]]),a.errors.newPassword?(t(),i("span",as,d(a.errors.newPassword),1)):f("",!0)]),e("div",os,[s[37]||(s[37]=e("label",{for:"confirmPassword"},"确认新密码",-1)),n(e("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":s[16]||(s[16]=o=>a.passwordData.confirmPassword=o),placeholder:"请再次输入新密码"},null,512),[[u,a.passwordData.confirmPassword]]),a.errors.confirmPassword?(t(),i("span",ts,d(a.errors.confirmPassword),1)):f("",!0)]),s[38]||(s[38]=e("button",{type:"submit",class:"btn primary"},"修改密码",-1))],32)])):f("",!0)])]),M(v,{ref:"feedback"},null,512)])}const fs=N(V,[["render",is],["__scopeId","data-v-ee6a8364"]]);export{fs as default};
//# sourceMappingURL=ProviderProfile-df6692cd.js.map
