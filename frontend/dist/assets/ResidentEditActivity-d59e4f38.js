import{c as u}from"./api-5fa05d82.js";import{_ as m,o as p,c as v,a as i,d as y,g as c,e as o,v as l}from"./index-1ef266be.js";const f={name:"ResidentEditActivity",data(){return{activity:{id:"",title:"",content:"",startTime:"",endTime:"",location:"",maxParticipants:0},submitting:!1,loading:!0}},mounted(){this.loadActivityData()},methods:{async loadActivityData(){const d=this.$route.params.id;try{const t=await u.getActivityDetail(d);if(t.code==="success"){const a=t.data.activity?t.data.activity:t.data,n=localStorage.getItem("userId");if(a.userId!=n){alert("您无权编辑此活动"),this.$router.push("/resident/activities");return}this.activity={...a,startTime:new Date(a.startTime).toISOString().slice(0,16),endTime:new Date(a.endTime).toISOString().slice(0,16)}}else alert(`获取活动详情失败：${t.message}`),this.$router.push("/resident/activities")}catch(t){console.error("获取活动详情失败:",t),alert("获取活动详情失败，请稍后重试"),this.$router.push("/resident/activities")}finally{this.loading=!1}},async handleUpdate(){if(!this.activity.title||!this.activity.content||!this.activity.startTime||!this.activity.endTime||!this.activity.location){alert("请填写所有必填字段");return}const d=new Date(this.activity.startTime),t=new Date(this.activity.endTime);if(d<new Date){alert("开始时间不能早于当前时间");return}if(t<=d){alert("结束时间必须晚于开始时间");return}this.submitting=!0;try{const n={...this.activity,startTime:new Date(this.activity.startTime).toISOString(),endTime:new Date(this.activity.endTime).toISOString()},s=await u.updateActivity(this.activity.id,n);s.code==="success"?(alert("活动更新成功！"),this.$router.push("/resident/activities")):alert(`活动更新失败：${s.message}`)}catch(n){console.error("活动更新失败:",n),alert("活动更新失败，请稍后重试")}finally{this.submitting=!1}},handleBack(){this.$router.push("/resident/activities")}}},h={class:"container"},T={class:"publish-form"},b={class:"form-group"},g={class:"form-group"},w={class:"form-row"},x={class:"form-group"},D={class:"form-group"},q={class:"form-group"},I={class:"form-group"},S={class:"form-actions"},U=["disabled"];function _(d,t,a,n,s,r){return p(),v("div",h,[i("header",null,[t[9]||(t[9]=i("h1",null,"编辑活动",-1)),i("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>r.handleBack&&r.handleBack(...e))},"返回活动列表")]),i("div",T,[i("form",{onSubmit:t[8]||(t[8]=y((...e)=>r.handleUpdate&&r.handleUpdate(...e),["prevent"]))},[i("div",b,[t[10]||(t[10]=i("label",{for:"title"},[c("活动标题 "),i("span",{class:"required"},"*")],-1)),o(i("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>s.activity.title=e),required:"",placeholder:"请输入活动标题"},null,512),[[l,s.activity.title]])]),i("div",g,[t[11]||(t[11]=i("label",{for:"content"},[c("活动内容 "),i("span",{class:"required"},"*")],-1)),o(i("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=e=>s.activity.content=e),required:"",placeholder:"请输入活动详细内容",rows:"6"},null,512),[[l,s.activity.content]])]),i("div",w,[i("div",x,[t[12]||(t[12]=i("label",{for:"startTime"},[c("开始时间 "),i("span",{class:"required"},"*")],-1)),o(i("input",{type:"datetime-local",id:"startTime","onUpdate:modelValue":t[3]||(t[3]=e=>s.activity.startTime=e),required:""},null,512),[[l,s.activity.startTime]])]),i("div",D,[t[13]||(t[13]=i("label",{for:"endTime"},[c("结束时间 "),i("span",{class:"required"},"*")],-1)),o(i("input",{type:"datetime-local",id:"endTime","onUpdate:modelValue":t[4]||(t[4]=e=>s.activity.endTime=e),required:""},null,512),[[l,s.activity.endTime]])])]),i("div",q,[t[14]||(t[14]=i("label",{for:"location"},[c("活动地点 "),i("span",{class:"required"},"*")],-1)),o(i("input",{type:"text",id:"location","onUpdate:modelValue":t[5]||(t[5]=e=>s.activity.location=e),required:"",placeholder:"请输入活动地点"},null,512),[[l,s.activity.location]])]),i("div",I,[t[15]||(t[15]=i("label",{for:"maxParticipants"},"最大参与人数",-1)),o(i("input",{type:"number",id:"maxParticipants","onUpdate:modelValue":t[6]||(t[6]=e=>s.activity.maxParticipants=e),min:"0",placeholder:"0表示无限制"},null,512),[[l,s.activity.maxParticipants,void 0,{number:!0}]])]),i("div",S,[i("button",{type:"submit",class:"btn btn-primary",disabled:s.submitting},"保存修改",8,U),i("button",{type:"button",class:"btn",onClick:t[7]||(t[7]=(...e)=>r.handleBack&&r.handleBack(...e))},"取消")])],32)])])}const B=m(f,[["render",_],["__scopeId","data-v-50c0e4fa"]]);export{B as default};
//# sourceMappingURL=ResidentEditActivity-d59e4f38.js.map
