import{_ as A,u as J,p as u,q as O,o as n,c as i,a as t,e as _,h as q,l as H,v as R,F as p,i as h,f as c,t as o,s as x,g as w,n as D}from"./index-1ef266be.js";import{p as k}from"./api-5fa05d82.js";const j={name:"ResidentPropertyFee",setup(){const M=J(),e=u([]),m=u({status:"",startDate:"",endDate:""}),s=u(!1),B=u(!1),v=u(null),l=u("wechat"),d=u(!1),f=u({}),P=u(!1),g=u(null),b=async()=>{try{const a=await k.getBills(1,100,{status:m.value.status,startDate:m.value.startDate,endDate:m.value.endDate});e.value=a.data||[]}catch(a){console.error("获取账单失败:",a),alert("获取账单失败，请稍后重试")}},C=a=>new Date(a).toLocaleDateString("zh-CN"),S=a=>(typeof a=="string"&&(a=new Date(a)),a.toLocaleString("zh-CN")),F=a=>({unpaid:"未支付",paid:"已支付",overdue:"已逾期",partially_paid:"部分支付"})[a]||a,T=a=>({wechat:"微信支付",alipay:"支付宝",bank_transfer:"银行转账",auto_deduction:"自动扣费"})[a]||a,I=a=>({pending:"待处理",success:"成功",failed:"失败",refunded:"已退款"})[a]||a,V=()=>{m.value={status:"",startDate:"",endDate:""},b()},N=a=>{v.value=a,l.value="wechat",s.value=!0},U=async()=>{var a,r;if(v.value){d.value=!0;try{const y=await k.initiatePayment({billId:v.value.id,paymentMethod:l.value,amount:v.value.amount});f.value={status:"success",message:"支付成功！",transactionId:y.data.transactionId},b()}catch(y){console.error("支付失败:",y),f.value={status:"failed",message:((r=(a=y.response)==null?void 0:a.data)==null?void 0:r.message)||"支付失败，请稍后重试"}}finally{d.value=!1,s.value=!1,B.value=!0}}},E=async a=>{try{const r=await k.getBillDetail(a.id);g.value=r.data.bill||a;const y=await k.getPaymentHistory(1,10,{billId:a.id});g.value.payments=y.data||[],P.value=!0}catch(r){console.error("获取账单详情失败:",r),alert("获取账单详情失败，请稍后重试")}},z=async()=>{try{alert("自动扣费设置成功")}catch(a){console.error("设置自动扣费失败:",a),alert("设置自动扣费失败，请稍后重试")}},L=()=>{M.push("/resident")};return O(()=>{b()}),{bills:e,filter:m,showPaymentModal:s,showResultModal:B,selectedBill:v,selectedPaymentMethod:l,isProcessing:d,paymentResult:f,showBillDetailModal:P,selectedBillDetail:g,getBills:b,formatDate:C,formatDateTime:S,getStatusText:F,getPaymentMethodText:T,getPaymentStatusText:I,resetFilter:V,payBill:N,confirmPayment:U,viewPaymentDetails:E,setupAutoDeduction:z,goBack:L}}},G={class:"property-fee-container"},K={class:"header-section"},Q={class:"filter-section"},W={class:"filter-item"},X={class:"filter-item"},Y={class:"filter-item"},Z={class:"filter-item"},$={class:"bills-section"},tt={class:"bill-header"},et={class:"period-info"},st={class:"amount-info"},lt={class:"total-amount"},at={class:"bill-details"},ot={class:"fee-items"},nt={class:"due-date"},it={key:0,class:"overdue-tag"},dt={class:"reminder-status"},rt={class:"bill-actions"},ut=["onClick"],ct=["onClick"],mt={key:0,class:"empty-state"},vt={key:0,class:"modal"},yt={class:"modal-content"},ft={class:"modal-header"},_t={class:"modal-body"},Dt={class:"payment-method"},bt={class:"method-options"},pt={class:"modal-footer"},ht=["disabled"],kt={key:1,class:"modal"},Bt={class:"modal-content"},gt={class:"modal-header"},wt={class:"modal-body"},Mt={key:0},Pt={key:1},Rt={key:0},xt={key:1},Ct={class:"modal-footer"},St={key:2,class:"modal"},Ft={class:"modal-content detail-modal"},Tt={class:"modal-header"},It={class:"header-buttons"},Vt={class:"modal-body"},Nt={class:"detail-section"},Ut={class:"detail-row"},Et={class:"detail-value"},zt={class:"detail-row"},Lt={class:"detail-value"},At={class:"detail-row"},Jt={class:"detail-value amount"},Ot={class:"detail-row"},qt={class:"detail-value"},Ht={class:"detail-row"},jt={class:"detail-value"},Gt={key:0,class:"overdue-tag"},Kt={class:"detail-row"},Qt={class:"detail-value"},Wt={class:"detail-section"},Xt={class:"fee-items-table"},Yt={class:"detail-section"},Zt={class:"payments-table"},$t={class:"transaction-id"},te={key:0},ee={class:"modal-footer"};function se(M,e,m,s,B,v){return n(),i("div",G,[t("div",K,[t("button",{class:"btn btn-back",onClick:e[0]||(e[0]=(...l)=>s.goBack&&s.goBack(...l))},"返回首页"),e[16]||(e[16]=t("h2",null,"物业费账单",-1))]),t("div",Q,[t("div",W,[e[18]||(e[18]=t("label",{for:"status-filter"},"状态筛选：",-1)),_(t("select",{id:"status-filter","onUpdate:modelValue":e[1]||(e[1]=l=>s.filter.status=l)},[...e[17]||(e[17]=[H('<option value="" data-v-659768f0>全部</option><option value="unpaid" data-v-659768f0>未支付</option><option value="paid" data-v-659768f0>已支付</option><option value="overdue" data-v-659768f0>逾期</option><option value="partially_paid" data-v-659768f0>部分支付</option>',5)])],512),[[q,s.filter.status]])]),t("div",X,[e[19]||(e[19]=t("label",{for:"start-date"},"开始日期：",-1)),_(t("input",{type:"date",id:"start-date","onUpdate:modelValue":e[2]||(e[2]=l=>s.filter.startDate=l)},null,512),[[R,s.filter.startDate]])]),t("div",Y,[e[20]||(e[20]=t("label",{for:"end-date"},"结束日期：",-1)),_(t("input",{type:"date",id:"end-date","onUpdate:modelValue":e[3]||(e[3]=l=>s.filter.endDate=l)},null,512),[[R,s.filter.endDate]])]),t("div",Z,[t("button",{class:"btn btn-primary",onClick:e[4]||(e[4]=(...l)=>s.getBills&&s.getBills(...l))},"查询"),t("button",{class:"btn btn-secondary",onClick:e[5]||(e[5]=(...l)=>s.resetFilter&&s.resetFilter(...l))},"重置")])]),t("div",$,[(n(!0),i(p,null,h(s.bills,l=>(n(),i("div",{class:"bill-card",key:l.id},[t("div",tt,[t("div",et,[t("h3",null,"费用周期："+o(s.formatDate(l.periodStart))+" 至 "+o(s.formatDate(l.periodEnd)),1),t("span",{class:D(["bill-status",l.status])},o(s.getStatusText(l.status)),3)]),t("div",st,[t("span",lt,"¥"+o(l.amount.toFixed(2)),1)])]),t("div",at,[e[22]||(e[22]=t("h4",null,"费用明细：",-1)),t("ul",ot,[(n(!0),i(p,null,h(l.items?JSON.parse(l.items):[{name:"物业费",amount:l.amount}],(d,f)=>(n(),i("li",{key:f},o(d.name)+"：¥"+o(d.amount.toFixed(2)),1))),128))]),t("div",nt,[t("span",null,"缴费截止日期："+o(s.formatDate(l.dueDate)),1),l.status==="overdue"?(n(),i("span",it,"已逾期")):c("",!0)]),t("div",dt,[e[21]||(e[21]=t("span",null,"催缴提醒：",-1)),t("span",{class:D(l.paymentDeadlineReminderSent?"reminder-sent":"reminder-not-sent")},o(l.paymentDeadlineReminderSent?"已发送":"未发送"),3)])]),t("div",rt,[l.status!=="paid"?(n(),i("button",{key:0,class:"btn btn-pay",onClick:d=>s.payBill(l)}," 一键支付 ",8,ut)):c("",!0),t("button",{class:"btn btn-view",onClick:d=>s.viewPaymentDetails(l)}," 查看详情 ",8,ct)])]))),128)),s.bills.length===0?(n(),i("div",mt,[...e[23]||(e[23]=[t("p",null,"暂无账单数据",-1)])])):c("",!0)]),s.showPaymentModal?(n(),i("div",vt,[t("div",yt,[t("div",ft,[e[24]||(e[24]=t("h3",null,"支付确认",-1)),t("button",{class:"close-btn",onClick:e[6]||(e[6]=l=>s.showPaymentModal=!1)},"×")]),t("div",_t,[e[28]||(e[28]=t("p",null,"确认支付账单：",-1)),t("p",null,"费用周期："+o(s.formatDate(s.selectedBill.periodStart))+" 至 "+o(s.formatDate(s.selectedBill.periodEnd)),1),t("p",null,"总金额：¥"+o(s.selectedBill.amount.toFixed(2)),1),t("div",Dt,[e[27]||(e[27]=t("label",null,"选择支付方式：",-1)),t("div",bt,[t("label",null,[_(t("input",{type:"radio","onUpdate:modelValue":e[7]||(e[7]=l=>s.selectedPaymentMethod=l),value:"wechat"},null,512),[[x,s.selectedPaymentMethod]]),e[25]||(e[25]=w(" 微信支付 ",-1))]),t("label",null,[_(t("input",{type:"radio","onUpdate:modelValue":e[8]||(e[8]=l=>s.selectedPaymentMethod=l),value:"alipay"},null,512),[[x,s.selectedPaymentMethod]]),e[26]||(e[26]=w(" 支付宝 ",-1))])])])]),t("div",pt,[t("button",{class:"btn btn-secondary",onClick:e[9]||(e[9]=l=>s.showPaymentModal=!1)},"取消"),t("button",{class:"btn btn-primary",onClick:e[10]||(e[10]=(...l)=>s.confirmPayment&&s.confirmPayment(...l)),disabled:s.isProcessing},o(s.isProcessing?"支付中...":"确认支付"),9,ht)])])])):c("",!0),s.showResultModal?(n(),i("div",kt,[t("div",Bt,[t("div",gt,[e[29]||(e[29]=t("h3",null,"支付结果",-1)),t("button",{class:"close-btn",onClick:e[11]||(e[11]=l=>s.showResultModal=!1)},"×")]),t("div",wt,[t("div",{class:D(["result-icon",s.paymentResult.status])},[s.paymentResult.status==="success"?(n(),i("span",Mt,"✓")):(n(),i("span",Pt,"✗"))],2),t("h4",null,o(s.paymentResult.message),1),s.paymentResult.status==="success"?(n(),i("p",Rt,"交易ID："+o(s.paymentResult.transactionId),1)):c("",!0),s.paymentResult.status==="success"?(n(),i("p",xt,"支付时间："+o(s.formatDateTime(new Date)),1)):c("",!0)]),t("div",Ct,[t("button",{class:"btn btn-primary",onClick:e[12]||(e[12]=l=>s.showResultModal=!1)},"确定")])])])):c("",!0),s.showBillDetailModal?(n(),i("div",St,[t("div",Ft,[t("div",Tt,[t("div",It,[t("button",{class:"btn btn-back",onClick:e[13]||(e[13]=l=>s.showBillDetailModal=!1)}," 返回 "),e[30]||(e[30]=t("h3",null,"账单详情",-1))]),t("button",{class:"close-btn",onClick:e[14]||(e[14]=l=>s.showBillDetailModal=!1)},"×")]),t("div",Vt,[t("div",Nt,[t("div",Ut,[e[31]||(e[31]=t("div",{class:"detail-label"},"账单ID：",-1)),t("div",Et,o(s.selectedBillDetail.id),1)]),t("div",zt,[e[32]||(e[32]=t("div",{class:"detail-label"},"费用周期：",-1)),t("div",Lt,o(s.formatDate(s.selectedBillDetail.periodStart))+" 至 "+o(s.formatDate(s.selectedBillDetail.periodEnd)),1)]),t("div",At,[e[33]||(e[33]=t("div",{class:"detail-label"},"总金额：",-1)),t("div",Jt,"¥"+o(s.selectedBillDetail.amount.toFixed(2)),1)]),t("div",Ot,[e[34]||(e[34]=t("div",{class:"detail-label"},"账单状态：",-1)),t("div",qt,[t("span",{class:D(["bill-status",s.selectedBillDetail.status])},o(s.getStatusText(s.selectedBillDetail.status)),3)])]),t("div",Ht,[e[35]||(e[35]=t("div",{class:"detail-label"},"缴费截止日期：",-1)),t("div",jt,[w(o(s.formatDate(s.selectedBillDetail.dueDate))+" ",1),s.selectedBillDetail.status==="overdue"?(n(),i("span",Gt,"已逾期")):c("",!0)])]),t("div",Kt,[e[36]||(e[36]=t("div",{class:"detail-label"},"催缴提醒：",-1)),t("div",Qt,o(s.selectedBillDetail.paymentDeadlineReminderSent?"已发送":"未发送"),1)]),t("div",Wt,[e[38]||(e[38]=t("h4",null,"费用明细：",-1)),t("table",Xt,[e[37]||(e[37]=t("thead",null,[t("tr",null,[t("th",null,"费用项目"),t("th",null,"金额")])],-1)),t("tbody",null,[(n(!0),i(p,null,h(s.selectedBillDetail.items?JSON.parse(s.selectedBillDetail.items):[{name:"物业费",amount:s.selectedBillDetail.amount}],(l,d)=>(n(),i("tr",{key:d},[t("td",null,o(l.name),1),t("td",null,"¥"+o(l.amount.toFixed(2)),1)]))),128))])])]),t("div",Yt,[e[41]||(e[41]=t("h4",null,"相关支付记录：",-1)),t("table",Zt,[e[40]||(e[40]=t("thead",null,[t("tr",null,[t("th",null,"支付ID"),t("th",null,"交易ID"),t("th",null,"支付金额"),t("th",null,"支付方式"),t("th",null,"支付时间"),t("th",null,"状态")])],-1)),t("tbody",null,[(n(!0),i(p,null,h(s.selectedBillDetail.payments||[],l=>(n(),i("tr",{key:l.id},[t("td",null,o(l.id),1),t("td",$t,o(l.transactionId),1),t("td",null,"¥"+o(l.amount.toFixed(2)),1),t("td",null,o(s.getPaymentMethodText(l.paymentMethod)),1),t("td",null,o(s.formatDateTime(l.paymentTime)),1),t("td",null,[t("span",{class:D(["payment-status",l.status])},o(s.getPaymentStatusText(l.status)),3)])]))),128)),(s.selectedBillDetail.payments||[]).length===0?(n(),i("tr",te,[...e[39]||(e[39]=[t("td",{colspan:"6",class:"no-data"},"暂无支付记录",-1)])])):c("",!0)])])])])]),t("div",ee,[t("button",{class:"btn btn-primary",onClick:e[15]||(e[15]=l=>s.showBillDetailModal=!1)},"关闭")])])])):c("",!0)])}const oe=A(j,[["render",se],["__scopeId","data-v-659768f0"]]);export{oe as default};
//# sourceMappingURL=ResidentPropertyFee-399ff7d6.js.map
