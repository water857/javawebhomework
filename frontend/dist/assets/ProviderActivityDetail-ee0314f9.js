import{c}from"./api-5fa05d82.js";import{_ as u,o as l,c as r,a as i,t as o,n as y,f as d,e as v,v as h,h as m,l as g,d as p}from"./index-1ef266be.js";const b={name:"ProviderActivityDetail",data(){return{activity:null,loading:!0,evaluation:{content:"",rating:5},submitting:!1,isRegistered:!1,canRegister:!1,canCheckin:!1}},mounted(){this.loadActivityDetail()},methods:{async loadActivityDetail(){const e=this.$route.params.id;try{const t=await c.getActivityDetail(e);t.code==="success"?(this.activity=t.data,this.checkRegistrationStatus()):(alert(`获取活动详情失败：${t.message}`),this.$router.push("/provider/activities"))}catch(t){console.error("获取活动详情失败:",t),alert("获取活动详情失败，请稍后重试"),this.$router.push("/provider/activities")}finally{this.loading=!1}},formatDateTime(e){return new Date(e).toLocaleString("zh-CN")},getStatusText(e){return{pending:"待开始",ongoing:"进行中",completed:"已完成",cancelled:"已取消"}[e]||e},checkRegistrationStatus(){this.isRegistered=!1,this.canRegister=this.activity.status==="pending",this.canCheckin=this.activity.status==="ongoing"},async handleRegister(){try{const e=await c.registerForActivity(this.activity.id);e.code==="success"?(alert("报名成功"),this.isRegistered=!0,this.canRegister=!1,this.activity.currentParticipants++):alert(`报名失败：${e.message}`)}catch(e){console.error("报名失败:",e),alert("报名失败，请稍后重试")}},async handleCancelRegistration(){try{const e=await c.cancelRegistration(this.activity.id);e.code==="success"?(alert("取消报名成功"),this.isRegistered=!1,this.canRegister=this.activity.status==="pending",this.activity.currentParticipants--):alert(`取消报名失败：${e.message}`)}catch(e){console.error("取消报名失败:",e),alert("取消报名失败，请稍后重试")}},async handleCheckin(){try{const e=await c.checkin(this.activity.id);e.code==="success"?(alert("签到成功"),this.canCheckin=!1):alert(`签到失败：${e.message}`)}catch(e){console.error("签到失败:",e),alert("签到失败，请稍后重试")}},async handleEvaluate(){this.submitting=!0;try{const e=await c.evaluateActivity(this.activity.id,this.evaluation);e.code==="success"?(alert("评价成功"),this.evaluation={content:"",rating:5}):alert(`评价失败：${e.message}`)}catch(e){console.error("评价失败:",e),alert("评价失败，请稍后重试")}finally{this.submitting=!1}},handleEdit(){this.$router.push(`/provider/activities/edit/${this.activity.id}`)},async handleDelete(){if(confirm("确定要删除这个活动吗？"))try{const e=await c.deleteActivity(this.activity.id);e.code==="success"?(alert("活动删除成功"),this.$router.push("/provider/activities")):alert(`删除失败：${e.message}`)}catch(e){console.error("删除活动失败:",e),alert("删除活动失败，请稍后重试")}},handleBack(){this.$router.push("/provider/activities")}}},f={class:"container"},k={key:0,class:"activity-detail"},C={class:"activity-header"},R={class:"activity-meta"},D={class:"meta-item"},_={class:"meta-item"},S={class:"meta-item"},w={class:"meta-item"},A={class:"activity-content"},x={class:"content-text"},I={class:"activity-actions"},T={key:0,class:"activity-evaluation"},E={class:"form-group"},P={class:"form-group"},B=["disabled"],M={key:1,class:"loading"},N={key:2,class:"error"};function V(e,t,z,U,s,a){return l(),r("div",f,[i("header",null,[t[9]||(t[9]=i("h1",null,"活动详情",-1)),i("button",{class:"btn",onClick:t[0]||(t[0]=(...n)=>a.handleBack&&a.handleBack(...n))},"返回活动列表")]),s.activity?(l(),r("div",k,[i("div",C,[i("h2",null,o(s.activity.title),1),i("p",{class:y(["activity-status",s.activity.status])},o(a.getStatusText(s.activity.status)),3)]),i("div",R,[i("div",D,[t[10]||(t[10]=i("span",{class:"meta-label"},"发布者：",-1)),i("span",null,o(s.activity.publisherName||"匿名"),1)]),i("div",_,[t[11]||(t[11]=i("span",{class:"meta-label"},"时间：",-1)),i("span",null,o(a.formatDateTime(s.activity.startTime))+" - "+o(a.formatDateTime(s.activity.endTime)),1)]),i("div",S,[t[12]||(t[12]=i("span",{class:"meta-label"},"地点：",-1)),i("span",null,o(s.activity.location),1)]),i("div",w,[t[13]||(t[13]=i("span",{class:"meta-label"},"参与人数：",-1)),i("span",null,o(s.activity.currentParticipants)+"/"+o(s.activity.maxParticipants||"无限制"),1)])]),i("div",A,[t[14]||(t[14]=i("h3",null,"活动内容",-1)),i("div",x,o(s.activity.content),1)]),i("div",I,[s.canRegister?(l(),r("button",{key:0,class:"btn btn-primary",onClick:t[1]||(t[1]=(...n)=>a.handleRegister&&a.handleRegister(...n))},"报名活动")):d("",!0),s.isRegistered?(l(),r("button",{key:1,class:"btn btn-primary",onClick:t[2]||(t[2]=(...n)=>a.handleCancelRegistration&&a.handleCancelRegistration(...n))},"取消报名")):d("",!0),s.canCheckin?(l(),r("button",{key:2,class:"btn btn-primary",onClick:t[3]||(t[3]=(...n)=>a.handleCheckin&&a.handleCheckin(...n))},"签到")):d("",!0),s.activity.publisherId===e.localStorage.getItem("userId")?(l(),r("button",{key:3,class:"btn btn-edit",onClick:t[4]||(t[4]=(...n)=>a.handleEdit&&a.handleEdit(...n))},"编辑活动")):d("",!0),s.activity.publisherId===e.localStorage.getItem("userId")?(l(),r("button",{key:4,class:"btn btn-delete",onClick:t[5]||(t[5]=(...n)=>a.handleDelete&&a.handleDelete(...n))},"删除活动")):d("",!0)]),s.activity.status==="completed"?(l(),r("div",T,[t[18]||(t[18]=i("h3",null,"活动评价",-1)),i("form",{onSubmit:t[8]||(t[8]=p((...n)=>a.handleEvaluate&&a.handleEvaluate(...n),["prevent"]))},[i("div",E,[t[15]||(t[15]=i("label",{for:"evaluation"},"评价内容",-1)),v(i("textarea",{id:"evaluation","onUpdate:modelValue":t[6]||(t[6]=n=>s.evaluation.content=n),placeholder:"请输入您对活动的评价",rows:"4"},null,512),[[h,s.evaluation.content]])]),i("div",P,[t[17]||(t[17]=i("label",{for:"rating"},"评分",-1)),v(i("select",{id:"rating","onUpdate:modelValue":t[7]||(t[7]=n=>s.evaluation.rating=n)},[...t[16]||(t[16]=[g('<option value="1" data-v-0ed67ad1>1星</option><option value="2" data-v-0ed67ad1>2星</option><option value="3" data-v-0ed67ad1>3星</option><option value="4" data-v-0ed67ad1>4星</option><option value="5" data-v-0ed67ad1>5星</option>',5)])],512),[[m,s.evaluation.rating,void 0,{number:!0}]])]),i("button",{type:"submit",class:"btn btn-primary",disabled:s.submitting},"提交评价",8,B)],32)])):d("",!0)])):s.loading?(l(),r("div",M,"加载中...")):(l(),r("div",N,"无法获取活动详情"))])}const j=u(b,[["render",V],["__scopeId","data-v-0ed67ad1"]]);export{j as default};
//# sourceMappingURL=ProviderActivityDetail-ee0314f9.js.map
