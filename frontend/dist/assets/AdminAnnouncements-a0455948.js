import{b as u}from"./api-5fa05d82.js";import{_ as m,o as l,c as r,a as t,e as d,v as g,h as f,F as _,i as p,t as o,f as b,n as v,d as h}from"./index-1ef266be.js";const A={name:"AdminAnnouncements",data(){return{announcements:[],loading:!1,searchQuery:"",statusFilter:"",currentPage:1,pageSize:10,totalPages:1}},mounted(){this.fetchAnnouncements()},activated(){this.fetchAnnouncements()},methods:{previousPage(){this.currentPage>1&&(this.currentPage--,this.fetchAnnouncements())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchAnnouncements())},async fetchAnnouncements(){this.loading=!0;try{const s=this.statusFilter!==""?parseInt(this.statusFilter):null,e=await u.getAnnouncements(this.currentPage,this.pageSize,this.searchQuery,s);e.code==="success"?(this.announcements=e.data,this.totalPages=e.totalPages||1):console.error("获取公告列表失败:",e.message)}catch(s){console.error("获取公告列表失败:",s),alert("获取公告列表失败，请稍后重试")}finally{this.loading=!1}},handleAnnouncementDetail(s){this.$router.push(`/admin/announcements/${s}`)},handlePublishAnnouncement(){this.$router.push("/admin/announcements/publish")},handleBack(){this.$router.push("/admin")},handleEditAnnouncement(s){this.$router.push(`/admin/announcements/edit/${s}`)},async handleDeleteAnnouncement(s){if(confirm("确定要删除这条公告吗？"))try{const e=await u.deleteAnnouncement(s);e.code==="success"?(alert("公告删除成功"),this.fetchAnnouncements()):(console.error("删除公告失败:",e.message),alert("删除公告失败"))}catch(e){console.error("删除公告失败:",e),alert("删除公告失败，请稍后重试")}},formatDateTime(s){if(!s)return"";if(typeof s=="string")return s;const e=new Date(s);return isNaN(e.getTime())?"":e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},getStatusText(s){return s===1?"已发布":"草稿"},getStatusClass(s){return s===1?"published":"draft"},truncateContent(s){return s?s.length>100?s.substring(0,100)+"...":s:""}}},P={class:"container"},y={class:"header-actions"},k={class:"announcements-section"},C={class:"filter-section"},x={class:"announcements-list"},D={key:0,class:"loading"},S={key:1,class:"no-data"},F=["onClick"],B={class:"announcement-content"},N={class:"announcement-info"},w={class:"announcement-actions"},z=["onClick"],Q=["onClick"],V={key:0,class:"pagination"},E=["disabled"],M=["disabled"];function T(s,e,I,L,i,a){return l(),r("div",P,[t("header",null,[e[7]||(e[7]=t("h1",null,"公告管理",-1)),t("div",y,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...n)=>a.handlePublishAnnouncement&&a.handlePublishAnnouncement(...n))},"发布公告"),t("button",{class:"btn",onClick:e[1]||(e[1]=(...n)=>a.handleBack&&a.handleBack(...n))},"返回首页")])]),t("div",k,[t("div",C,[d(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>i.searchQuery=n),class:"search-input",placeholder:"搜索公告"},null,512),[[g,i.searchQuery]]),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=n=>i.statusFilter=n),class:"filter-select"},[...e[8]||(e[8]=[t("option",{value:""},"全部状态",-1),t("option",{value:"1"},"已发布",-1),t("option",{value:"0"},"草稿",-1)])],512),[[f,i.statusFilter]]),t("button",{class:"btn",onClick:e[4]||(e[4]=(...n)=>a.fetchAnnouncements&&a.fetchAnnouncements(...n))},"筛选")]),t("div",x,[i.loading?(l(),r("div",D,"加载中...")):i.announcements.length===0?(l(),r("div",S,"暂无公告")):(l(!0),r(_,{key:2},p(i.announcements,n=>(l(),r("div",{class:"announcement-card",key:n.id},[t("div",{onClick:c=>a.handleAnnouncementDetail(n.id)},[t("h3",null,o(n.title),1),t("p",B,o(a.truncateContent(n.content)),1),t("p",{class:v(["announcement-status",a.getStatusClass(n.status)])},o(a.getStatusText(n.status)),3),t("div",N,[t("span",null,"发布者: "+o(n.authorName||"匿名"),1),t("span",null,"发布时间: "+o(a.formatDateTime(n.publishedAt||n.createdAt)),1)])],8,F),t("div",w,[t("button",{class:"btn btn-edit",onClick:h(c=>a.handleEditAnnouncement(n.id),["stop"])},"编辑",8,z),t("button",{class:"btn btn-delete",onClick:h(c=>a.handleDeleteAnnouncement(n.id),["stop"])},"删除",8,Q)])]))),128))]),i.totalPages>1?(l(),r("div",V,[t("button",{class:"btn",onClick:e[5]||(e[5]=(...n)=>a.previousPage&&a.previousPage(...n)),disabled:i.currentPage===1},"上一页",8,E),t("span",null,o(i.currentPage)+"/"+o(i.totalPages),1),t("button",{class:"btn",onClick:e[6]||(e[6]=(...n)=>a.nextPage&&a.nextPage(...n)),disabled:i.currentPage===i.totalPages},"下一页",8,M)])):b("",!0)])])}const q=m(A,[["render",T],["__scopeId","data-v-5182d9fc"]]);export{q as default};
//# sourceMappingURL=AdminAnnouncements-a0455948.js.map
